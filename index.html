<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"noarsark.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.12.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="noarsark&#39;s blog">
<meta property="og:url" content="https://noarsark.github.io/index.html">
<meta property="og:site_name" content="noarsark&#39;s blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="noarsark">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://noarsark.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>noarsark's blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">noarsark's blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">noarsark</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/noarsark" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;noarsark" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noarsark.github.io/2022/07/27/windows%E4%B8%8B%E5%AE%89%E8%A3%85redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="noarsark">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="noarsark's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | noarsark's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/27/windows%E4%B8%8B%E5%AE%89%E8%A3%85redis/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-27 20:12:15" itemprop="dateCreated datePublished" datetime="2022-07-27T20:12:15+08:00">2022-07-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-02-09 11:13:53" itemprop="dateModified" datetime="2022-02-09T11:13:53+08:00">2022-02-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Windows-环境下安装-Redis"><a href="#Windows-环境下安装-Redis" class="headerlink" title="Windows 环境下安装 Redis"></a>Windows 环境下安装 Redis</h1><p>关于 Redis 的具体介绍以及使用就不在这里赘述了，具体可以看我相关的博客，本篇仅介绍在 Windows 环境下安装 Redis 的过程。</p>
<h2 id="1、下载地址"><a href="#1、下载地址" class="headerlink" title="1、下载地址"></a>1、下载地址</h2><p><a target="_blank" rel="noopener" href="https://github.com/MicrosoftArchive/redis/releases">github.com&#x2F;MicrosoftArchive&#x2F;redis&#x2F;…</a><br>或者<br><a target="_blank" rel="noopener" href="https://github.com/tporadowski/redis/releases">github.com&#x2F;tporadowski&#x2F;redis&#x2F;relea…</a><br>注意的是官方是没有发布 Windows 版本的，一直都是微软在维护的。Redis 支持 32 位和 64 位。这个需要根据你系统平台的实际情况选择。</p>
<p>这里以官方维护的最后一个版本 Redis-x64-3.2.100 为例，解压后目录结构如下</p>
<p><a target="_blank" rel="noopener" href="https://cdn.learnku.com/uploads/images/202009/07/64799/F40n7j4MmR.png!large"><img src="https://cdn.learnku.com/uploads/images/202009/07/64799/F40n7j4MmR.png!large" alt="Windows 环境下安装 Redis"></a></p>
<h2 id="2、启动临时服务"><a href="#2、启动临时服务" class="headerlink" title="2、启动临时服务"></a>2、启动临时服务</h2><p>打开 cmd，进入到刚才解压到的目录，启动临时服务：<code>redis-server.exe redis.windows.conf</code> (备注：通过这个命令，会创建 Redis 临时服务，不会在 window Service 列表出现 Redis 服务名称和状态，此窗口关闭，服务会自动关闭。)</p>
<p><a target="_blank" rel="noopener" href="https://cdn.learnku.com/uploads/images/202009/07/64799/EfuwNEcZE4.png!large"><img src="https://cdn.learnku.com/uploads/images/202009/07/64799/EfuwNEcZE4.png!large" alt="Windows 环境下安装 Redis"></a></p>
<p>打开另一个 cmd 窗口，客户端调用：<code>redis-cli.exe -h 127.0.0.1 -p 6379 -a 123456</code>(-h 服务器地址 -p 服务端口号 -a 连接数据库的密码 [可以在 redis.windows.conf 中配置]，默认无密码)</p>
<p><a target="_blank" rel="noopener" href="https://cdn.learnku.com/uploads/images/202009/07/64799/qTpdwWbxzp.png!large"><img src="https://cdn.learnku.com/uploads/images/202009/07/64799/qTpdwWbxzp.png!large" alt="Windows 环境下安装 Redis"></a></p>
<h2 id="3、Redis-自定义-windows-服务安装"><a href="#3、Redis-自定义-windows-服务安装" class="headerlink" title="3、Redis 自定义 windows 服务安装"></a>3、Redis 自定义 windows 服务安装</h2><p>进入 Redis 安装包目录，安装服务：<code>redis-server.exe --service-install redis.windows.conf --service-name redis --loglevel verbose</code></p>
<p><code>win+r</code> -&gt; <code>services.msc</code>, 可以看到服务安装成功</p>
<p><a target="_blank" rel="noopener" href="https://cdn.learnku.com/uploads/images/202009/07/64799/qjjdK21ZOO.png!large"><img src="https://cdn.learnku.com/uploads/images/202009/07/64799/qjjdK21ZOO.png!large" alt="Windows 环境下安装 Redis"></a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">安装服务：redis-server.exe --service-install redis.windows.conf --service-name redis --loglevel verbose</span><br><span class="line"></span><br><span class="line">启动服务：redis-server.exe  --service-start --service-name redis</span><br><span class="line"></span><br><span class="line">停止服务：redis-server.exe  --service-stop --service-name redis</span><br><span class="line"></span><br><span class="line">卸载服务：redis-server.exe  --service-uninstall --service-name redis</span><br></pre></td></tr></table></figure>

<h2 id="4、命令行启功服务"><a href="#4、命令行启功服务" class="headerlink" title="4、命令行启功服务"></a>4、命令行启功服务</h2><p>命令行最好在管理员身份下运行</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">可以使用net和sc</span><br><span class="line"><span class="number">1</span>、net用于打开 没有被禁用 的服务:</span><br><span class="line">NET命令是功能强大的以命令行方式执行的工具。</span><br><span class="line">启动和关闭服务的时候，其语法是：</span><br><span class="line"></span><br><span class="line">net start 服务名</span><br><span class="line"></span><br><span class="line">net stop 服务名</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、用sc可打开 被禁用 的服务。</span><br><span class="line">sc是用于与服务控制管理器和服务进行通信的命令行程序，其语法是：</span><br><span class="line"></span><br><span class="line">sc config 服务名 start= demand        <span class="comment">//手动</span></span><br><span class="line"></span><br><span class="line">sc condig 服务名 start= auto        <span class="comment">//自动</span></span><br><span class="line"></span><br><span class="line">sc config 服务名 start= disabled    <span class="comment">//禁用</span></span><br><span class="line"></span><br><span class="line">sc start 服务名</span><br><span class="line"></span><br><span class="line">sc stop 服务名</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://cdn.learnku.com/uploads/images/202010/10/64799/yR1I94kAv2.png!large"><img src="https://cdn.learnku.com/uploads/images/202010/10/64799/yR1I94kAv2.png!large" alt="Windows 环境下安装 Redis"></a></p>
<h2 id="5、配置文件"><a href="#5、配置文件" class="headerlink" title="5、配置文件"></a>5、配置文件</h2><p>配置文件相关配置：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 是否作为守护进程运行</span></span><br><span class="line">daemonize no</span><br><span class="line"><span class="comment"># Redis 默认监听端口</span></span><br><span class="line">port <span class="number">6379</span></span><br><span class="line"><span class="comment"># 客户端闲置多少秒后，断开连接</span></span><br><span class="line">timeout <span class="number">300</span></span><br><span class="line"><span class="comment"># 日志显示级别</span></span><br><span class="line">loglevel verbose</span><br><span class="line"><span class="comment"># 指定日志输出的文件名，也可指定到标准输出端口</span></span><br><span class="line">logfile redis.log</span><br><span class="line"><span class="comment"># 设置数据库的数量，默认最大是16,默认连接的数据库是0，可以通过select N 来连接不同的数据库</span></span><br><span class="line">databases <span class="number">32</span></span><br><span class="line"><span class="comment"># Dump持久化策略</span></span><br><span class="line"><span class="comment"># 当有一条Keys 数据被改变是，900 秒刷新到disk 一次</span></span><br><span class="line"><span class="comment"># save 900 1</span></span><br><span class="line"><span class="comment"># 当有10 条Keys 数据被改变时，300 秒刷新到disk 一次</span></span><br><span class="line">save <span class="number">300</span> <span class="number">100</span></span><br><span class="line"><span class="comment"># 当有1w 条keys 数据被改变时，60 秒刷新到disk 一次</span></span><br><span class="line">save <span class="number">6000</span> <span class="number">10000</span></span><br><span class="line"><span class="comment"># 当dump.rdb 数据库的时候是否压缩数据对象</span></span><br><span class="line">rdbcompression yes</span><br><span class="line"><span class="comment"># dump 持久化数据保存的文件名</span></span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"><span class="comment">########### Replication #####################</span></span><br><span class="line"><span class="comment"># Redis的主从配置,配置slaveof则实例作为从服务器</span></span><br><span class="line"><span class="comment"># slaveof 192.168.0.105 6379</span></span><br><span class="line"><span class="comment"># 主服务器连接密码</span></span><br><span class="line"><span class="comment"># masterauth &lt;master-password&gt;</span></span><br><span class="line"><span class="comment">############## 安全性 ###########</span></span><br><span class="line"><span class="comment"># 设置连接密码</span></span><br><span class="line"><span class="comment"># requirepass &lt;password&gt;</span></span><br><span class="line"><span class="comment">############### LIMITS ##############</span></span><br><span class="line"><span class="comment"># 最大客户端连接数</span></span><br><span class="line"><span class="comment"># maxclients 128</span></span><br><span class="line"><span class="comment"># 最大内存使用率</span></span><br><span class="line"><span class="comment"># maxmemory &lt;bytes&gt;</span></span><br><span class="line"><span class="comment">########## APPEND ONLY MODE #########</span></span><br><span class="line"><span class="comment"># 是否开启日志功能</span></span><br><span class="line">appendonly no</span><br><span class="line"><span class="comment"># AOF持久化策略</span></span><br><span class="line"><span class="comment"># appendfsync always</span></span><br><span class="line"><span class="comment"># appendfsync everysec</span></span><br><span class="line"><span class="comment"># appendfsync no</span></span><br><span class="line"><span class="comment">################ VIRTUAL MEMORY ###########</span></span><br><span class="line"><span class="comment"># 是否开启VM 功能</span></span><br><span class="line"><span class="comment"># vm-enabled no</span></span><br><span class="line"><span class="comment"># vm-enabled yes</span></span><br><span class="line"><span class="comment"># vm-swap-file logs/redis.swap</span></span><br><span class="line"><span class="comment"># vm-max-memory 0</span></span><br><span class="line"><span class="comment"># vm-page-size 32</span></span><br><span class="line"><span class="comment"># vm-pages 134217728</span></span><br><span class="line"><span class="comment"># vm-max-threads 4</span></span><br></pre></td></tr></table></figure>

<p>主从复制</p>
<p>在从服务器配置文件中配置slaveof ,填写服务器IP及端口即可,如果主服务器设置了连接密码,在masterauth后指定密码就行了。</p>
<p>持久化</p>
<p>redis提供了两种持久化文案,Dump持久化和AOF日志文件持久化。</p>
<p>Dump持久化是把内存中的数据完整写入到数据文件,由配置策略触发写入,如果在数据更改后又未达到触发条件而发生故障会造成部分数据丢失。</p>
<p>AOF持久化是日志存储的,是增量的形式,记录每一个数据操作动作,数据恢复时就根据这些日志来生成。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noarsark.github.io/2022/07/10/Netty%E5%AD%A6%E4%B9%A0%E4%B9%8BNIO%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="noarsark">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="noarsark's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | noarsark's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/10/Netty%E5%AD%A6%E4%B9%A0%E4%B9%8BNIO%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">Netty学习之NIO基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-10 21:02:10" itemprop="dateCreated datePublished" datetime="2022-07-10T21:02:10+08:00">2022-07-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-27 20:24:19" itemprop="dateModified" datetime="2022-07-27T20:24:19+08:00">2022-07-27</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>本博客是根据<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1py4y1E7oA?p=2">黑马程序员Netty实战</a>学习时所做的笔记</p>
<p>可先参考博客<a target="_blank" rel="noopener" href="https://nyimac.gitee.io/2020/11/30/Java%20NIO/">Java NIO</a></p>
<h1 id="一、三大组件简介"><a href="#一、三大组件简介" class="headerlink" title="一、三大组件简介"></a>一、三大组件简介</h1><p>Channel与Buffer</p>
<p>Java NIO系统的<strong>核心</strong>在于：<strong>通道(Channel)和缓冲区(Buffer)<strong>。通道表示打开到 IO 设备(例如：文件、套接字)的连接。若需要使用 NIO 系统，需要获取用于</strong>连接 IO 设备的通道</strong>以及用于<strong>容纳数据的缓冲区</strong>。然后操作缓冲区，对数据进行处理。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/07/10/Netty%E5%AD%A6%E4%B9%A0%E4%B9%8BNIO%E5%9F%BA%E7%A1%80/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noarsark.github.io/2022/07/10/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="noarsark">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="noarsark's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | noarsark's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/10/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-07-10 14:05:48 / 修改时间：21:15:56" itemprop="dateCreated datePublished" datetime="2022-07-10T14:05:48+08:00">2022-07-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/07/10/hello-world/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noarsark.github.io/2020/09/28/ArrayList%E5%BA%8F%E5%88%97%E5%8C%96%E6%8A%80%E6%9C%AF%E7%BB%86%E8%8A%82%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="noarsark">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="noarsark's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | noarsark's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/09/28/ArrayList%E5%BA%8F%E5%88%97%E5%8C%96%E6%8A%80%E6%9C%AF%E7%BB%86%E8%8A%82%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">ArrayList序列化技术细节详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-09-28 21:28:09" itemprop="dateCreated datePublished" datetime="2020-09-28T21:28:09+08:00">2020-09-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-12-01 15:28:32" itemprop="dateModified" datetime="2020-12-01T15:28:32+08:00">2020-12-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="一、绪论"><a href="#一、绪论" class="headerlink" title="一、绪论"></a>一、绪论</h1><p>所谓的JAVA序列化与反序列化，序列化就是将JAVA 对象以一种的形式保持，比如存放到硬盘，或是用于传输。反序列化是序列化的一个逆过程。</p>
<p>JAVA规定被序列化的对象必须实现java.io.Serializable这个接口，而我们分析的目标ArrayList同样实现了该接口。</p>
<p>通过对ArrayList源码的分析，可以知道ArrayList的数据存储都是依赖于elementData数组，它的声明为：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">transient</span> Object[] elementData;</span><br><span class="line">注意<span class="keyword">transient</span>修饰着elementData这个数组。</span><br></pre></td></tr></table></figure>

<h2 id="1、先看看transient关键字的作用"><a href="#1、先看看transient关键字的作用" class="headerlink" title="1、先看看transient关键字的作用"></a>1、先看看transient关键字的作用</h2><p>我们都知道一个对象只要实现了Serilizable接口，这个对象就可以被序列化，java的这种序列化模式为开发者提供了很多便利，我们可以不必关系具体序列化的过程，只要这个类实现了Serilizable接口，这个类的所有属性和方法都会自动序列化。</p>
<p>   然而在实际开发过程中，我们常常会遇到这样的问题，这个类的有些属性需要序列化，而其他属性不需要被序列化，打个比方，如果一个用户有一些敏感信息（如密码，银行卡号等），为了安全起见，不希望在网络操作（主要涉及到序列化操作，本地序列化缓存也适用）中被传输，这些信息对应的变量就可以加上 transient关键字。换句话说，这个字段的生命周期仅存于调用者的内存中而不会写到磁盘里持久化。</p>
<p>总之，java 的transient关键字为我们提供了便利，你只需要实现Serilizable接口，将不需要序列化的属性前添加关键字transient，序列化对象的时候，这个属性就不会序列化到指定的目的地中。</p>
<p>具体详见：<a target="_blank" rel="noopener" href="http://www.cnblogs.com/lanxuezaipiao/p/3369962.html">Java transient关键字使用小记</a></p>
<p>既然elementData被transient修饰，按理来说，它不能被序列化的，那么ArrayList又是如何解决序列化这个问题的呢？</p>
<h1 id="二、序列化工作流程"><a href="#二、序列化工作流程" class="headerlink" title="二、序列化工作流程"></a>二、序列化工作流程</h1><p>类通过实现java.io.Serializable接口可以启用其序列化功能。要序列化一个对象，必须与一定的对象输出／输入流联系起来，通过对象输出流将对象状态保存下来，再通过对象输入流将对象状态恢复。</p>
<p>在序列化和反序列化过程中需要特殊处理的类必须使用下列准确签名来实现特殊方法：</p>
<p>private void writeObject(java.io.ObjectOutputStream out) throws IOException</p>
<p>private void readObject(java.io.ObjectInputStream in) throws IOException, ClassNotFoundException</p>
<h2 id="1、对象序列化步骤"><a href="#1、对象序列化步骤" class="headerlink" title="1、对象序列化步骤"></a>1、对象序列化步骤</h2><p>a) 写入</p>
<ul>
<li>首先创建一个OutputStream输出流；</li>
<li>然后创建一个ObjectOutputStream输出流，并传入OutputStream输出流对象；</li>
<li>最后调用ObjectOutputStream对象的writeObject()方法将对象状态信息写入OutputStream。</li>
</ul>
<p>b)读取</p>
<ul>
<li>首先创建一个InputStream输入流；</li>
<li>然后创建一个ObjectInputStream输入流，并传入InputStream输入流对象；</li>
<li>最后调用ObjectInputStream对象的readObject()方法从InputStream中读取对象状态信息。</li>
</ul>
<p>举例说明：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Box</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">3450064362986273896L</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> width;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> height;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Box myBox=<span class="keyword">new</span> <span class="title class_">Box</span>();</span><br><span class="line">        myBox.setWidth(<span class="number">50</span>);</span><br><span class="line">        myBox.setHeight(<span class="number">30</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileOutputStream fs=<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;F:\\foo.ser&quot;</span>);</span><br><span class="line">            ObjectOutputStream os=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fs);</span><br><span class="line">            os.writeObject(myBox);</span><br><span class="line">            os.close();</span><br><span class="line">            FileInputStream fi=<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;F:\\foo.ser&quot;</span>);</span><br><span class="line">            ObjectInputStream oi=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fi);</span><br><span class="line">            Box box=(Box)oi.readObject();</span><br><span class="line">            oi.close();</span><br><span class="line">            System.out.println(box.height+<span class="string">&quot;,&quot;</span>+box.width);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getWidth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> width;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWidth</span><span class="params">(<span class="type">int</span> width)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.width = width;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> height;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHeight</span><span class="params">(<span class="type">int</span> height)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.height = height;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="三、ArrayList解决序列化"><a href="#三、ArrayList解决序列化" class="headerlink" title="三、ArrayList解决序列化"></a>三、ArrayList解决序列化</h1><h2 id="1、序列化"><a href="#1、序列化" class="headerlink" title="1、序列化"></a>1、序列化</h2><p>从上面序列化的工作流程可以看出，要想序列化对象，使用ObjectOutputStream对象输出流的writeObject()方法写入对象状态信息，即可使用readObject()方法读取信息。</p>
<p>那是不是可以在ArrayList中调用ObjectOutputStream对象的writeObject()方法将elementData的值写入输出流呢？</p>
<p>见源码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">writeObject</span><span class="params">(java.io.ObjectOutputStream s)</span> <span class="keyword">throws</span> java.io.IOException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Write out element count, and any hidden stuff</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">expectedModCount</span> <span class="operator">=</span> modCount;</span><br><span class="line">    s.defaultWriteObject();</span><br><span class="line">    <span class="comment">// Write out size as capacity for behavioural compatibility with clone()</span></span><br><span class="line">    s.writeInt(size);</span><br><span class="line">    <span class="comment">// Write out all elements in the proper order.</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        s.writeObject(elementData[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>虽然elementData被transient修饰，不能被序列化，但是我们可以将它的值取出来，然后将该值写入输出流。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 片段1 它的功能等价于片段2</span></span><br><span class="line">s.writeObject(elementData[i]);  <span class="comment">// 传值时，是将实参elementData[i]赋给s.writeObject()的形参</span></span><br><span class="line"><span class="comment">//  片段2</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();     <span class="comment">// temp并没有被transient修饰</span></span><br><span class="line">temp = elementData[i];</span><br><span class="line">s.writeObject(temp);</span><br></pre></td></tr></table></figure>

<h2 id="2、反序列化"><a href="#2、反序列化" class="headerlink" title="2、反序列化"></a>2、反序列化</h2><p>ArrayList的反序列化处理原理同上，见源码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(java.io.ObjectInputStream s)</span> <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException</span><br><span class="line">&#123;</span><br><span class="line">    elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">    <span class="comment">// Read in size, and any hidden stuff</span></span><br><span class="line">    s.defaultReadObject();</span><br><span class="line">    <span class="comment">// Read in capacity</span></span><br><span class="line">    s.readInt(); <span class="comment">// ignored</span></span><br><span class="line">    <span class="keyword">if</span> (size &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// be like clone(), allocate array based upon size not capacity</span></span><br><span class="line">        ensureCapacityInternal(size);</span><br><span class="line">        Object[] a = elementData;</span><br><span class="line">        <span class="comment">// Read in all elements in the proper order.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            a[i] = s.readObject();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从上面源码又引出另外一个问题，这些方法都定义为private的，那什么时候能调用呢？</p>
<h2 id="3、调用"><a href="#3、调用" class="headerlink" title="3、调用"></a>3、调用</h2><p>如果一个类不仅实现了Serializable接口，而且定义了 readObject（ObjectInputStream in）和 writeObject(ObjectOutputStream out)方法，那么将按照如下的方式进行序列化和反序列化：</p>
<blockquote>
<p>ObjectOutputStream会调用这个类的writeObject方法进行序列化，ObjectInputStream会调用相应的readObject方法进行反序列化。</p>
</blockquote>
<p>事情到底是这样的吗？我们做个小实验，来验明正身。<br>实验1：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestSerialization</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="type">int</span>    num;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNum</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNum</span><span class="params">(<span class="type">int</span> num)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.num = num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">writeObject</span><span class="params">(java.io.ObjectOutputStream s)</span></span><br><span class="line">            <span class="keyword">throws</span> java.io.IOException</span><br><span class="line">    &#123;</span><br><span class="line">        s.defaultWriteObject();</span><br><span class="line">        s.writeObject(num);</span><br><span class="line">        System.out.println(<span class="string">&quot;writeObject of &quot;</span>+<span class="built_in">this</span>.getClass().getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span><br><span class="line">            <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException</span><br><span class="line">    &#123;</span><br><span class="line">        s.defaultReadObject();</span><br><span class="line">        num = (Integer) s.readObject();</span><br><span class="line">        System.out.println(<span class="string">&quot;readObject of &quot;</span>+<span class="built_in">this</span>.getClass().getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">TestSerialization</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestSerialization</span>();</span><br><span class="line">        test.setNum(<span class="number">10</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;序列化之前的值：&quot;</span>+test.getNum());</span><br><span class="line">        <span class="comment">// 写入</span></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">ObjectOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:\\test.tmp&quot;</span>));</span><br><span class="line">            outputStream.writeObject(test);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 读取</span></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">ObjectInputStream</span> <span class="variable">oInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:\\test.tmp&quot;</span>));</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">TestSerialization</span> <span class="variable">aTest</span> <span class="operator">=</span> (TestSerialization) oInputStream.readObject();</span><br><span class="line">                System.out.println(<span class="string">&quot;读取序列化后的值：&quot;</span>+aTest.getNum());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e)</span><br><span class="line">            &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<p>序列化之前的值：10<br>writeObject of TestSerialization<br>readObject of TestSerialization<br>读取序列化后的值：10</p>
<p>实验结果证明，事实确实是如此：</p>
<p>ObjectOutputStream会调用这个类的writeObject方法进行序列化，ObjectInputStream会调用相应的readObject方法进行反序列化。<br>那么ObjectOutputStream又是如何知道一个类是否实现了writeObject方法呢？又是如何自动调用该类的writeObject方法呢？</p>
<p>答案是：是通过反射机制实现的。</p>
<p>部分解答：</p>
<p>ObjectOutputStream的writeObject又做了哪些事情。它会根据传进来的ArrayList对象得到Class，然后再包装成 ObjectStreamClass，在writeSerialData方法里，会调用ObjectStreamClass的 invokeWriteObject方法，最重要的代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">writeObjectMethod.invoke(obj, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123; out &#125;);</span><br></pre></td></tr></table></figure>

<p>实例变量writeObjectMethod的赋值方式如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">writeObjectMethod = getPrivateMethod(cl, <span class="string">&quot;writeObject&quot;</span>, </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; ObjectOutputStream.class &#125;, </span><br><span class="line">                Void.TYPE);</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> Method <span class="title function_">getPrivateMethod</span><span class="params">(Class cl, String name,</span></span><br><span class="line"><span class="params">        Class[] argTypes, Class returnType)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Method</span> <span class="variable">meth</span> <span class="operator">=</span> cl.getDeclaredMethod(name, argTypes);</span><br><span class="line">        <span class="comment">// *****通过反射访问对象的private方法</span></span><br><span class="line">        meth.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">mods</span> <span class="operator">=</span> meth.getModifiers();</span><br><span class="line">        <span class="keyword">return</span> ((meth.getReturnType() == returnType)</span><br><span class="line">                &amp;&amp; ((mods &amp; Modifier.STATIC) == <span class="number">0</span>) &amp;&amp; ((mods &amp; Modifier.PRIVATE) != <span class="number">0</span>)) ? meth</span><br><span class="line">                : <span class="literal">null</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchMethodException ex)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在做实验时，我们发现一个问题，那就是为什么需要s.defaultWriteObject();和s.defaultReadObject();语句在<code>readObject(ObjectInputStream o)</code> and <code>writeObject(ObjectOutputStream o)</code>之前呢？</p>
<p>它们的作用如下：</p>
<p>1、It reads and writes all the <code>non transient</code> fields of the class respectively.</p>
<p>2、 These methods also helps in backward and future compatibility. If in future you add some <code>non-transient</code> field to the class and you are trying to deserialize it by the older version of class then the defaultReadObject() method will neglect the newly added field, similarly if you deserialize the old serialized object by the new version then the new non transient field will take default value from JVM</p>
<h1 id="四、为什么使用transient修饰elementData？"><a href="#四、为什么使用transient修饰elementData？" class="headerlink" title="四、为什么使用transient修饰elementData？"></a>四、为什么使用transient修饰elementData？</h1><p>既然要将ArrayList的字段序列化（即将elementData序列化），那为什么又要用transient修饰elementData呢？</p>
<p>回想ArrayList的自动扩容机制，elementData数组相当于容器，当容器不足时就会再扩充容量，但是容器的容量往往都是大于或者等于ArrayList所存元素的个数。</p>
<p>比如，现在实际有了8个元素，那么elementData数组的容量可能是8x1.5&#x3D;12，如果直接序列化elementData数组，那么就会浪费4个元素的空间，特别是当元素个数非常多时，这种浪费是非常不合算的。</p>
<p>所以ArrayList的设计者将elementData设计为transient，然后在writeObject方法中手动将其序列化，并且只序列化了实际存储的那些元素，而不是整个数组。</p>
<p>见源码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Write out all elements in the proper order.</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;size; i++) </span><br><span class="line">&#123;</span><br><span class="line">    s.writeObject(elementData[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从源码中，可以观察到 循环时是使用i&lt;size而不是 i&lt;elementData.length，说明序列化时，只需实际存储的那些元素，而不是整个数组。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noarsark.github.io/2020/09/28/%E8%81%8A%E4%B8%80%E8%81%8AHashMap/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="noarsark">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="noarsark's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | noarsark's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/09/28/%E8%81%8A%E4%B8%80%E8%81%8AHashMap/" class="post-title-link" itemprop="url">聊一聊HashMap的源码</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-09-28 21:28:09" itemprop="dateCreated datePublished" datetime="2020-09-28T21:28:09+08:00">2020-09-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-12-01 15:28:07" itemprop="dateModified" datetime="2020-12-01T15:28:07+08:00">2020-12-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>HashMap作为Java容器里比较重要的一员，实现的源码一直很值得我们研究，下面就结合源码来聊一聊吧。为了便于理解，以下源码分析以 JDK 1.7 为主。</p>
<h3 id="1-存储结构"><a href="#1-存储结构" class="headerlink" title="1. 存储结构"></a>1. 存储结构</h3><p>内部包含了一个 Entry 类型的数组 table。Entry 存储着键值对。它包含了四个字段，从 next 字段我们可以看出 Entry 是一个链表。即数组中的每个位置被当成一个桶，一个桶存放一个链表。HashMap 使用拉链法来解决冲突，同一个链表中存放哈希值和散列桶取模运算结果相同的 Entry。</p>
<p><a target="_blank" rel="noopener" href="https://camo.githubusercontent.com/5d81dca069e6bd97466ee40c53ea963696cfc1ef/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230383233343934383230352e706e67"><img src="https://camo.githubusercontent.com/5d81dca069e6bd97466ee40c53ea963696cfc1ef/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230383233343934383230352e706e67" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">transient</span> Entry[] table;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entry</span>&lt;K,V&gt; <span class="keyword">implements</span> <span class="title class_">Map</span>.Entry&lt;K,V&gt; &#123;</span><br><span class="line">    <span class="keyword">final</span> K key;</span><br><span class="line">    V value;</span><br><span class="line">    Entry&lt;K,V&gt; next;</span><br><span class="line">    <span class="type">int</span> hash;</span><br><span class="line"></span><br><span class="line">    Entry(<span class="type">int</span> h, K k, V v, Entry&lt;K,V&gt; n) &#123;</span><br><span class="line">        value = v;</span><br><span class="line">        next = n;</span><br><span class="line">        key = k;</span><br><span class="line">        hash = h;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> K <span class="title function_">getKey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">setValue</span><span class="params">(V newValue)</span> &#123;</span><br><span class="line">        <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> value;</span><br><span class="line">        value = newValue;</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> Map.Entry))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        Map.<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> (Map.Entry)o;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">k1</span> <span class="operator">=</span> getKey();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">k2</span> <span class="operator">=</span> e.getKey();</span><br><span class="line">        <span class="keyword">if</span> (k1 == k2 || (k1 != <span class="literal">null</span> &amp;&amp; k1.equals(k2))) &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">v1</span> <span class="operator">=</span> getValue();</span><br><span class="line">            <span class="type">Object</span> <span class="variable">v2</span> <span class="operator">=</span> e.getValue();</span><br><span class="line">            <span class="keyword">if</span> (v1 == v2 || (v1 != <span class="literal">null</span> &amp;&amp; v1.equals(v2)))</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hashCode(getKey()) ^ Objects.hashCode(getValue());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getKey() + <span class="string">&quot;=&quot;</span> + getValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-拉链法的工作原理"><a href="#2-拉链法的工作原理" class="headerlink" title="2. 拉链法的工作原理"></a>2. 拉链法的工作原理</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">HashMap&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;K1&quot;</span>, <span class="string">&quot;V1&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;K2&quot;</span>, <span class="string">&quot;V2&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;K3&quot;</span>, <span class="string">&quot;V3&quot;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>新建一个 HashMap，默认大小为 16；</li>
<li>插入 &lt;K1,V1&gt; 键值对，先计算 K1 的 hashCode 为 115，使用除留余数法得到所在的桶下标 115%16&#x3D;3。</li>
<li>插入 &lt;K2,V2&gt; 键值对，先计算 K2 的 hashCode 为 118，使用除留余数法得到所在的桶下标 118%16&#x3D;6。</li>
<li>插入 &lt;K3,V3&gt; 键值对，先计算 K3 的 hashCode 为 118，使用除留余数法得到所在的桶下标 118%16&#x3D;6，插在 &lt;K2,V2&gt; 前面。</li>
</ul>
<p>应该注意到链表的插入是以头插法方式进行的，例如上面的 &lt;K3,V3&gt; 不是插在 &lt;K2,V2&gt; 后面，而是插入在链表头部。</p>
<p>查找需要分成两步进行：</p>
<ul>
<li>计算键值对所在的桶；</li>
<li>在链表上顺序查找，时间复杂度显然和链表的长度成正比。</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://camo.githubusercontent.com/a7761ef5ade932ba3513693653ee65bedfa0f5db/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230383233353235383634332e706e67"><img src="https://camo.githubusercontent.com/a7761ef5ade932ba3513693653ee65bedfa0f5db/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230383233353235383634332e706e67" alt="img"></a></p>
<h3 id="3-put-操作"><a href="#3-put-操作" class="headerlink" title="3. put 操作"></a>3. put 操作</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (table == EMPTY_TABLE) &#123;</span><br><span class="line">        inflateTable(threshold);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 键为 null 单独处理</span></span><br><span class="line">    <span class="keyword">if</span> (key == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> putForNullKey(value);</span><br><span class="line">    <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> hash(key);</span><br><span class="line">    <span class="comment">// 确定桶下标</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> indexFor(hash, table.length);</span><br><span class="line">    <span class="comment">// 先找出是否已经存在键为 key 的键值对，如果存在的话就更新这个键值对的值为 value</span></span><br><span class="line">    <span class="keyword">for</span> (Entry&lt;K,V&gt; e = table[i]; e != <span class="literal">null</span>; e = e.next) &#123;</span><br><span class="line">        Object k;</span><br><span class="line">        <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123;</span><br><span class="line">            <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> e.value;</span><br><span class="line">            e.value = value;</span><br><span class="line">            e.recordAccess(<span class="built_in">this</span>);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="comment">// 插入新键值对</span></span><br><span class="line">    addEntry(hash, key, value, i);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>HashMap 允许插入键为 null 的键值对。但是因为无法调用 null 的 hashCode() 方法，也就无法确定该键值对的桶下标，只能通过强制指定一个桶下标来存放。HashMap 使用第 0 个桶存放键为 null 的键值对。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> V <span class="title function_">putForNullKey</span><span class="params">(V value)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (Entry&lt;K,V&gt; e = table[<span class="number">0</span>]; e != <span class="literal">null</span>; e = e.next) &#123;</span><br><span class="line">        <span class="keyword">if</span> (e.key == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> e.value;</span><br><span class="line">            e.value = value;</span><br><span class="line">            e.recordAccess(<span class="built_in">this</span>);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    modCount++;</span><br><span class="line">    addEntry(<span class="number">0</span>, <span class="literal">null</span>, value, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用链表的头插法，也就是新的键值对插在链表的头部，而不是链表的尾部。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">addEntry</span><span class="params">(<span class="type">int</span> hash, K key, V value, <span class="type">int</span> bucketIndex)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((size &gt;= threshold) &amp;&amp; (<span class="literal">null</span> != table[bucketIndex])) &#123;</span><br><span class="line">        resize(<span class="number">2</span> * table.length);</span><br><span class="line">        hash = (<span class="literal">null</span> != key) ? hash(key) : <span class="number">0</span>;</span><br><span class="line">        bucketIndex = indexFor(hash, table.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    createEntry(hash, key, value, bucketIndex);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">createEntry</span><span class="params">(<span class="type">int</span> hash, K key, V value, <span class="type">int</span> bucketIndex)</span> &#123;</span><br><span class="line">    Entry&lt;K,V&gt; e = table[bucketIndex];</span><br><span class="line">    <span class="comment">// 头插法，链表头部指向新的键值对</span></span><br><span class="line">    table[bucketIndex] = <span class="keyword">new</span> <span class="title class_">Entry</span>&lt;&gt;(hash, key, value, e);</span><br><span class="line">    size++;</span><br><span class="line">&#125;</span><br><span class="line">Entry(<span class="type">int</span> h, K k, V v, Entry&lt;K,V&gt; n) &#123;</span><br><span class="line">    value = v;</span><br><span class="line">    next = n;</span><br><span class="line">    key = k;</span><br><span class="line">    hash = h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-确定桶下标"><a href="#4-确定桶下标" class="headerlink" title="4. 确定桶下标"></a>4. 确定桶下标</h3><p>很多操作都需要先确定一个键值对所在的桶下标。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> hash(key);</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> indexFor(hash, table.length);</span><br></pre></td></tr></table></figure>

<p><strong>4.1 计算 hash 值</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(Object k)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> hashSeed;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> != h &amp;&amp; k <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">        <span class="keyword">return</span> sun.misc.Hashing.stringHash32((String) k);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    h ^= k.hashCode();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This function ensures that hashCodes that differ only by</span></span><br><span class="line">    <span class="comment">// constant multiples at each bit position have a bounded</span></span><br><span class="line">    <span class="comment">// number of collisions (approximately 8 at default load factor).</span></span><br><span class="line">    h ^= (h &gt;&gt;&gt; <span class="number">20</span>) ^ (h &gt;&gt;&gt; <span class="number">12</span>);</span><br><span class="line">    <span class="keyword">return</span> h ^ (h &gt;&gt;&gt; <span class="number">7</span>) ^ (h &gt;&gt;&gt; <span class="number">4</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Objects.hashCode(key) ^ Objects.hashCode(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4.2 取模</strong></p>
<p>令 x &#x3D; 1&lt;&lt;4，即 x 为 2 的 4 次方，它具有以下性质：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">x   : <span class="number">00010000</span></span><br><span class="line">x-<span class="number">1</span> : <span class="number">00001111</span></span><br></pre></td></tr></table></figure>

<p>令一个数 y 与 x-1 做与运算，可以去除 y 位级表示的第 4 位以上数：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">y       : <span class="number">10110010</span></span><br><span class="line">x-<span class="number">1</span>     : <span class="number">00001111</span></span><br><span class="line">y&amp;(x-<span class="number">1</span>) : <span class="number">00000010</span></span><br></pre></td></tr></table></figure>

<p>这个性质和 y 对 x 取模效果是一样的：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">y   : <span class="number">10110010</span></span><br><span class="line">x   : <span class="number">00010000</span></span><br><span class="line">y%x : <span class="number">00000010</span></span><br></pre></td></tr></table></figure>

<p>我们知道，位运算的代价比求模运算小的多，因此在进行这种计算时用位运算的话能带来更高的性能。</p>
<p>确定桶下标的最后一步是将 key 的 hash 值对桶个数取模：hash%capacity，如果能保证 capacity 为 2 的 n 次方，那么就可以将这个操作转换为位运算。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="title function_">indexFor</span><span class="params">(<span class="type">int</span> h, <span class="type">int</span> length)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> h &amp; (length-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-扩容-基本原理"><a href="#5-扩容-基本原理" class="headerlink" title="5. 扩容-基本原理"></a>5. 扩容-基本原理</h3><p>设 HashMap 的 table 长度为 M，需要存储的键值对数量为 N，如果哈希函数满足均匀性的要求，那么每条链表的长度大约为 N&#x2F;M，因此查找的复杂度为 O(N&#x2F;M)。</p>
<p>为了让查找的成本降低，应该使 N&#x2F;M 尽可能小，因此需要保证 M 尽可能大，也就是说 table 要尽可能大。HashMap 采用动态扩容来根据当前的 N 值来调整 M 值，使得空间效率和时间效率都能得到保证。</p>
<p>和扩容相关的参数主要有：capacity、size、threshold 和 load_factor。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>capacity</td>
<td>table 的容量大小，默认为 16。需要注意的是 capacity 必须保证为 2 的 n 次方。</td>
</tr>
<tr>
<td>size</td>
<td>键值对数量。</td>
</tr>
<tr>
<td>threshold</td>
<td>size 的临界值，当 size 大于等于 threshold 就必须进行扩容操作。</td>
</tr>
<tr>
<td>loadFactor</td>
<td>装载因子，table 能够使用的比例，threshold &#x3D; (int)(capacity* loadFactor)。</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_INITIAL_CAPACITY</span> <span class="operator">=</span> <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAXIMUM_CAPACITY</span> <span class="operator">=</span> <span class="number">1</span> &lt;&lt; <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">float</span> <span class="variable">DEFAULT_LOAD_FACTOR</span> <span class="operator">=</span> <span class="number">0.75f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">transient</span> Entry[] table;</span><br><span class="line"></span><br><span class="line"><span class="keyword">transient</span> <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> threshold;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="type">float</span> loadFactor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">transient</span> <span class="type">int</span> modCount;</span><br></pre></td></tr></table></figure>

<p>从下面的添加元素代码中可以看出，当需要扩容时，令 capacity 为原来的两倍。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">addEntry</span><span class="params">(<span class="type">int</span> hash, K key, V value, <span class="type">int</span> bucketIndex)</span> &#123;</span><br><span class="line">    Entry&lt;K,V&gt; e = table[bucketIndex];</span><br><span class="line">    table[bucketIndex] = <span class="keyword">new</span> <span class="title class_">Entry</span>&lt;&gt;(hash, key, value, e);</span><br><span class="line">    <span class="keyword">if</span> (size++ &gt;= threshold)</span><br><span class="line">        resize(<span class="number">2</span> * table.length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>扩容使用 resize() 实现，需要注意的是，扩容操作同样需要把 oldTable 的所有键值对重新插入 newTable 中，因此这一步是很费时的。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">resize</span><span class="params">(<span class="type">int</span> newCapacity)</span> &#123;</span><br><span class="line">    Entry[] oldTable = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">oldCapacity</span> <span class="operator">=</span> oldTable.length;</span><br><span class="line">    <span class="keyword">if</span> (oldCapacity == MAXIMUM_CAPACITY) &#123;</span><br><span class="line">        threshold = Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Entry[] newTable = <span class="keyword">new</span> <span class="title class_">Entry</span>[newCapacity];</span><br><span class="line">    transfer(newTable);</span><br><span class="line">    table = newTable;</span><br><span class="line">    threshold = (<span class="type">int</span>)(newCapacity * loadFactor);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(Entry[] newTable)</span> &#123;</span><br><span class="line">    Entry[] src = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> newTable.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; src.length; j++) &#123;</span><br><span class="line">        Entry&lt;K,V&gt; e = src[j];</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">            src[j] = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                Entry&lt;K,V&gt; next = e.next;</span><br><span class="line">                <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> indexFor(e.hash, newCapacity);</span><br><span class="line">                e.next = newTable[i];</span><br><span class="line">                newTable[i] = e;</span><br><span class="line">                e = next;</span><br><span class="line">            &#125; <span class="keyword">while</span> (e != <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-扩容-重新计算桶下标"><a href="#6-扩容-重新计算桶下标" class="headerlink" title="6. 扩容-重新计算桶下标"></a>6. 扩容-重新计算桶下标</h3><p>在进行扩容时，需要把键值对重新计算桶下标，从而放到对应的桶上。在前面提到，HashMap 使用 hash%capacity 来确定桶下标。HashMap capacity 为 2 的 n 次方这一特点能够极大降低重新计算桶下标操作的复杂度。</p>
<p>假设原数组长度 capacity 为 16，扩容之后 new capacity 为 32：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">capacity     : <span class="number">00010000</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">capacity</span> : <span class="number">00100000</span></span><br></pre></td></tr></table></figure>

<p>对于一个 Key，它的哈希值 hash 在第 5 位：</p>
<ul>
<li>为 0，那么 hash%00010000 &#x3D; hash%00100000，桶位置和原来一致；</li>
<li>为 1，hash%00010000 &#x3D; hash%00100000 + 16，桶位置是原位置 + 16。</li>
</ul>
<h3 id="7-计算数组容量"><a href="#7-计算数组容量" class="headerlink" title="7. 计算数组容量"></a>7. 计算数组容量</h3><p>HashMap 构造函数允许用户传入的容量不是 2 的 n 次方，因为它可以自动地将传入的容量转换为 2 的 n 次方。</p>
<p>先考虑如何求一个数的掩码，对于 10010000，它的掩码为 11111111，可以使用以下方法得到：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">mask |= mask &gt;&gt; <span class="number">1</span>    <span class="number">11011000</span></span><br><span class="line">mask |= mask &gt;&gt; <span class="number">2</span>    <span class="number">11111110</span></span><br><span class="line">mask |= mask &gt;&gt; <span class="number">4</span>    <span class="number">11111111</span></span><br></pre></td></tr></table></figure>

<p>mask+1 是大于原始数字的最小的 2 的 n 次方。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">num     <span class="number">10010000</span></span><br><span class="line">mask+<span class="number">1</span> <span class="number">100000000</span></span><br></pre></td></tr></table></figure>

<p>以下是 HashMap 中计算数组容量的代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">tableSizeFor</span><span class="params">(<span class="type">int</span> cap)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> cap - <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">2</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">8</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">return</span> (n &lt; <span class="number">0</span>) ? <span class="number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-链表转红黑树"><a href="#8-链表转红黑树" class="headerlink" title="8. 链表转红黑树"></a>8. 链表转红黑树</h3><p>从 JDK 1.8 开始，一个桶存储的链表长度大于等于 8 时会将链表转换为红黑树。</p>
<h3 id="9-与-Hashtable-的比较"><a href="#9-与-Hashtable-的比较" class="headerlink" title="9. 与 Hashtable 的比较"></a>9. 与 Hashtable 的比较</h3><blockquote>
<p>1.<strong>HashTable的方法是同步的</strong>，在方法的前面都有synchronized来同步，<strong>HashMap未经同步</strong>，所以在多线程场合要手动同步<br>2.<strong>HashTable不允许null值</strong>(key和value都不可以) ,<strong>HashMap允许null值</strong>(key和value都可以)。<br>3.HashTable有一个contains(Object value)功能和containsValue(Object value)功能一样。<br>4.HashTable使用Enumeration进行遍历，HashMap使用Iterator进行遍历。<br>5.HashTable中hash数组默认大小是11，增加的方式是 old*2+1。HashMap中hash数组的默认大小是16，而且一定是2的指数。<br>6.哈希值的使用不同，HashTable直接使用对象的hashCode，代码是这样的：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> key.hashCode();</span><br><span class="line"><span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> (hash &amp; <span class="number">0x7FFFFFFF</span>) % tab.length;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>而HashMap重新计算hash值，而且用与代替求模</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noarsark.github.io/2020/06/15/%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90Java%E5%8F%8D%E5%B0%84%20-%20%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="noarsark">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="noarsark's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | noarsark's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/06/15/%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90Java%E5%8F%8D%E5%B0%84%20-%20%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">深入解析Java反射 - 基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-15 21:07:06" itemprop="dateCreated datePublished" datetime="2020-06-15T21:07:06+08:00">2020-06-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-12-22 22:39:12" itemprop="dateModified" datetime="2020-12-22T22:39:12+08:00">2020-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Spring的IOC部分非常依赖反射，因此趁这个机会来总结一下关于Java反射的一些知识。本篇为基本篇，基于JDK 1.8。</p>
<h1 id="一、回顾：什么是反射？"><a href="#一、回顾：什么是反射？" class="headerlink" title="一、回顾：什么是反射？"></a>一、回顾：什么是反射？</h1><p>反射 (Reflection) 是 Java 的特征之一，它允许运行中的 Java 程序获取自身的信息，并且可以操作类或对象的内部属性。</p>
<p>Oracle 官方对反射的解释是：</p>
<blockquote>
<p>Reflection enables Java code to discover information about the fields, methods and constructors of loaded classes, and to use reflected fields, methods, and constructors to operate on their underlying counterparts, within security restrictions.<br>The API accommodates applications that need access to either the public members of a target object (based on its runtime class) or the members declared by a given class. It also allows programs to suppress default reflective access control.</p>
</blockquote>
<p>简而言之，通过反射，我们可以在运行时获得程序或程序集中每一个类型的成员和成员的信息。程序中一般的对象的类型都是在编译期就确定下来的，而 Java 反射机制可以动态地创建对象并调用其属性，这样的对象的类型在编译期是未知的。所以我们可以通过反射机制直接创建对象，即使这个对象的类型在编译期是未知的。</p>
<p>反射的核心是 JVM 在运行时才动态加载类或调用方法&#x2F;访问属性，它不需要事先（写代码的时候或编译期）知道运行对象是谁。</p>
<p>Java 反射主要提供以下功能：</p>
<ul>
<li>在运行时判断任意一个对象所属的类；</li>
<li>在运行时构造任意一个类的对象；</li>
<li>在运行时判断任意一个类所具有的成员变量和方法（通过反射甚至可以调用private方法）；</li>
<li>在运行时调用任意一个对象的方法</li>
</ul>
<p>重点：<strong>是运行时而不是编译时</strong></p>
<h1 id="二、反射的主要用途"><a href="#二、反射的主要用途" class="headerlink" title="二、反射的主要用途"></a>二、反射的主要用途</h1><p>很多人都认为反射在实际的 Java 开发应用中并不广泛，其实不然。当我们在使用 IDE(如 Eclipse，IDEA)时，当我们输入一个对象或类并想调用它的属性或方法时，一按点号，编译器就会自动列出它的属性或方法，这里就会用到反射。</p>
<p><strong>反射最重要的用途就是开发各种通用框架。</strong>很多框架（比如 Spring）都是配置化的（比如通过 XML 文件配置 Bean），为了保证框架的通用性，它们可能需要根据配置文件加载不同的对象或类，调用不同的方法，这个时候就必须用到反射，运行时动态加载需要加载的对象。</p>
<p>举一个例子，在运用 Struts 2 框架的开发中我们一般会在 <code>struts.xml</code> 里去配置 <code>Action</code>，比如：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;login&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">class</span>=<span class="string">&quot;org.noarsark.test.action.SimpleLoginAction&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">method</span>=<span class="string">&quot;execute&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">result</span>&gt;</span>/shop/shop-index.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">&quot;error&quot;</span>&gt;</span>login.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置文件与 <code>Action</code> 建立了一种映射关系，当 View 层发出请求时，请求会被 <code>StrutsPrepareAndExecuteFilter</code> 拦截，然后 <code>StrutsPrepareAndExecuteFilter</code> 会去动态地创建 Action 实例。比如我们请求 <code>login.action</code>，那么 <code>StrutsPrepareAndExecuteFilter</code>就会去解析struts.xml文件，检索action中name为login的Action，并根据class属性创建SimpleLoginAction实例，并用invoke方法来调用execute方法，这个过程离不开反射。</p>
<p>对与框架开发人员来说，反射虽小但作用非常大，它是各种容器实现的核心。而对于一般的开发者来说，不深入框架开发则用反射用的就会少一点，不过了解一下框架的底层机制有助于丰富自己的编程思想，也是很有益的。</p>
<h1 id="三、反射的基本运用"><a href="#三、反射的基本运用" class="headerlink" title="三、反射的基本运用"></a>三、反射的基本运用</h1><p>上面我们提到了反射可以用于判断任意对象所属的类，获得 Class 对象，构造任意一个对象以及调用一个对象。这里我们介绍一下基本反射功能的使用和实现(反射相关的类一般都在 java.lang.relfect 包里)。</p>
<h2 id="1、获得-Class-对象"><a href="#1、获得-Class-对象" class="headerlink" title="1、获得 Class 对象"></a>1、获得 Class 对象</h2><p>方法有三种：</p>
<p>(1) 使用 Class 类的 <code>forName</code> 静态方法:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> Class&lt;?&gt; forName(String className)</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">比如在 JDBC 开发中常用此方法加载数据库驱动:</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line"> Class.forName(driver);</span><br></pre></td></tr></table></figure>

<p>(2)直接获取某一个对象的 class，比如:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class&lt;?&gt; klass = <span class="type">int</span>.class;</span><br><span class="line">Class&lt;?&gt; classInt = Integer.TYPE;</span><br></pre></td></tr></table></figure>

<p>(3)调用某个对象的 <code>getClass()</code> 方法，比如:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">StringBuilder</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">Class&lt;?&gt; klass = str.getClass();</span><br></pre></td></tr></table></figure>

<h2 id="2、判断是否为某个类的实例"><a href="#2、判断是否为某个类的实例" class="headerlink" title="2、判断是否为某个类的实例"></a>2、判断是否为某个类的实例</h2><p>一般地，我们用 <code>instanceof</code> 关键字来判断是否为某个类的实例。同时我们也可以借助反射中 Class 对象的 <code>isInstance()</code> 方法来判断是否为某个类的实例，它是一个 native 方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">isInstance</span><span class="params">(Object obj)</span>;</span><br></pre></td></tr></table></figure>

<h2 id="3、创建实例"><a href="#3、创建实例" class="headerlink" title="3、创建实例"></a>3、创建实例</h2><p>通过反射来生成对象主要有两种方式。</p>
<ul>
<li>使用Class对象的newInstance()方法来创建Class对象对应类的实例。</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class&lt;?&gt; c = String.class;</span><br><span class="line"><span class="type">Object</span> <span class="variable">str</span> <span class="operator">=</span> c.newInstance();</span><br></pre></td></tr></table></figure>

<ul>
<li>先通过Class对象获取指定的Constructor对象，再调用Constructor对象的newInstance()方法来创建实例。这种方法可以用指定的构造器构造类的实例。</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//获取String所对应的Class对象</span></span><br><span class="line">Class&lt;?&gt; c = String.class;</span><br><span class="line"><span class="comment">//获取String类带一个String参数的构造器</span></span><br><span class="line"><span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> c.getConstructor(String.class);</span><br><span class="line"><span class="comment">//根据构造器创建实例</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> constructor.newInstance(<span class="string">&quot;23333&quot;</span>);</span><br><span class="line">System.out.println(obj);</span><br></pre></td></tr></table></figure>

<h2 id="4、获取方法"><a href="#4、获取方法" class="headerlink" title="4、获取方法"></a>4、获取方法</h2><p>获取某个Class对象的方法集合，主要有以下几个方法：</p>
<ul>
<li><code>getDeclaredMethods</code> 方法返回类或接口声明的所有方法，包括公共、保护、默认（包）访问和私有方法，但不包括继承的方法。</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Method[] getDeclaredMethods() <span class="keyword">throws</span> SecurityException</span><br></pre></td></tr></table></figure>

<ul>
<li><code>getMethods</code> 方法返回某个类的所有公用（public）方法，包括其继承类的公用方法。</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Method[] getMethods() <span class="keyword">throws</span> SecurityException</span><br></pre></td></tr></table></figure>

<ul>
<li><code>getMethod</code> 方法返回一个特定的方法，其中第一个参数为方法名称，后面的参数为方法的参数对应Class的对象。</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Method <span class="title function_">getMethod</span><span class="params">(String name, Class&lt;?&gt;... parameterTypes)</span></span><br></pre></td></tr></table></figure>

<p>只是这样描述的话可能难以理解，我们用例子来理解这三个方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.noarsark.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test1</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException &#123;</span><br><span class="line">	        Class&lt;?&gt; c = methodClass.class;</span><br><span class="line">	        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> c.newInstance();</span><br><span class="line">	        Method[] methods = c.getMethods();</span><br><span class="line">	        Method[] declaredMethods = c.getDeclaredMethods();</span><br><span class="line">	        <span class="comment">//获取methodClass类的add方法</span></span><br><span class="line">	        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> c.getMethod(<span class="string">&quot;add&quot;</span>, <span class="type">int</span>.class, <span class="type">int</span>.class);</span><br><span class="line">	        <span class="comment">//getMethods()方法获取的所有方法</span></span><br><span class="line">	        System.out.println(<span class="string">&quot;getMethods获取的方法：&quot;</span>);</span><br><span class="line">	        <span class="keyword">for</span>(Method m:methods)</span><br><span class="line">	            System.out.println(m);</span><br><span class="line">	        <span class="comment">//getDeclaredMethods()方法获取的所有方法</span></span><br><span class="line">	        System.out.println(<span class="string">&quot;getDeclaredMethods获取的方法：&quot;</span>);</span><br><span class="line">	        <span class="keyword">for</span>(Method m:declaredMethods)</span><br><span class="line">	            System.out.println(m);</span><br><span class="line">	    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">methodClass</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">fuck</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a+b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a+b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>程序运行的结果如下:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">getMethods获取的方法：</span><br><span class="line">public int org.ScZyhSoft.common.methodClass.add(int,int)</span><br><span class="line">public int org.ScZyhSoft.common.methodClass.sub(int,int)</span><br><span class="line">public final void java.lang.Object.wait() throws java.lang.InterruptedException</span><br><span class="line">public final void java.lang.Object.wait(long,int) throws java.lang.InterruptedException</span><br><span class="line">public final native void java.lang.Object.wait(long) throws java.lang.InterruptedException</span><br><span class="line">public boolean java.lang.Object.equals(java.lang.Object)</span><br><span class="line">public java.lang.String java.lang.Object.toString()</span><br><span class="line">public native int java.lang.Object.hashCode()</span><br><span class="line">public final native java.lang.Class java.lang.Object.getClass()</span><br><span class="line">public final native void java.lang.Object.notify()</span><br><span class="line">public final native void java.lang.Object.notifyAll()</span><br><span class="line">getDeclaredMethods获取的方法：</span><br><span class="line">public int org.ScZyhSoft.common.methodClass.add(int,int)</span><br><span class="line">public int org.ScZyhSoft.common.methodClass.sub(int,int)</span><br></pre></td></tr></table></figure>

<p>可以看到，通过 <code>getMethods()</code> 获取的方法可以获取到父类的方法,比如 java.lang.Object 下定义的各个方法。</p>
<h2 id="5、获取构造器信息"><a href="#5、获取构造器信息" class="headerlink" title="5、获取构造器信息"></a>5、获取构造器信息</h2><p>获取类构造器的用法与上述获取方法的用法类似。主要是通过Class类的getConstructor方法得到Constructor类的一个实例，而Constructor类有一个newInstance方法可以创建一个对象实例:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> T <span class="title function_">newInstance</span><span class="params">(Object ... initargs)</span></span><br></pre></td></tr></table></figure>

<p>此方法可以根据传入的参数来调用对应的Constructor创建对象实例。</p>
<h2 id="6、获取类的成员变量（字段）信息"><a href="#6、获取类的成员变量（字段）信息" class="headerlink" title="6、获取类的成员变量（字段）信息"></a>6、获取类的成员变量（字段）信息</h2><p>主要是这几个方法，在此不再赘述：</p>
<ul>
<li><code>getFiled</code>：访问公有的成员变量</li>
<li><code>getDeclaredField</code>：所有已声明的成员变量，但不能得到其父类的成员变量</li>
</ul>
<p><code>getFileds</code> 和 <code>getDeclaredFields</code> 方法用法同上（参照 Method）。</p>
<h2 id="7、调用方法"><a href="#7、调用方法" class="headerlink" title="7、调用方法"></a>7、调用方法</h2><p>当我们从类中获取了一个方法后，我们就可以用 <code>invoke()</code> 方法来调用这个方法。<code>invoke</code> 方法的原型为:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object obj, Object... args)</span></span><br><span class="line">        <span class="keyword">throws</span> IllegalAccessException, IllegalArgumentException,</span><br><span class="line">           InvocationTargetException</span><br></pre></td></tr></table></figure>

<p>下面是一个实例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException &#123;</span><br><span class="line">        Class&lt;?&gt; klass = methodClass.class;</span><br><span class="line">        <span class="comment">//创建methodClass的实例</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> klass.newInstance();</span><br><span class="line">        <span class="comment">//获取methodClass类的add方法</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> klass.getMethod(<span class="string">&quot;add&quot;</span>,<span class="type">int</span>.class,<span class="type">int</span>.class);</span><br><span class="line">        <span class="comment">//调用method对应的方法 =&gt; add(1,4)</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(obj,<span class="number">1</span>,<span class="number">4</span>);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">methodClass</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">fuck</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a+b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a+b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关于 <code>invoke</code> 方法的详解，后面我会专门写一篇文章来深入解析 invoke 的过程。</p>
<h2 id="8、利用反射创建数组"><a href="#8、利用反射创建数组" class="headerlink" title="8、利用反射创建数组"></a>8、利用反射创建数组</h2><p>数组在Java里是比较特殊的一种类型，它可以赋值给一个Object Reference。下面我们看一看利用反射创建数组的例子：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testArray</span><span class="params">()</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        Class&lt;?&gt; cls = Class.forName(<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">array</span> <span class="operator">=</span> Array.newInstance(cls,<span class="number">25</span>);</span><br><span class="line">        <span class="comment">//往数组里添加内容</span></span><br><span class="line">        Array.set(array,<span class="number">0</span>,<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        Array.set(array,<span class="number">1</span>,<span class="string">&quot;Java&quot;</span>);</span><br><span class="line">        Array.set(array,<span class="number">2</span>,<span class="string">&quot;fuck&quot;</span>);</span><br><span class="line">        Array.set(array,<span class="number">3</span>,<span class="string">&quot;Scala&quot;</span>);</span><br><span class="line">        Array.set(array,<span class="number">4</span>,<span class="string">&quot;Clojure&quot;</span>);</span><br><span class="line">        <span class="comment">//获取某一项的内容</span></span><br><span class="line">        System.out.println(Array.get(array,<span class="number">3</span>));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>其中的Array类为java.lang.reflect.Array类。我们通过Array.newInstance()创建数组对象，它的原型是:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">newInstance</span><span class="params">(Class&lt;?&gt; componentType, <span class="type">int</span> length)</span></span><br><span class="line">        <span class="keyword">throws</span> NegativeArraySizeException &#123;</span><br><span class="line">        <span class="keyword">return</span> newArray(componentType, length);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>而 <code>newArray</code> 方法是一个 native 方法，它在 HotSpot JVM 里的具体实现我们后边再研究，这里先把源码贴出来：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">native</span> Object <span class="title function_">newArray</span><span class="params">(Class&lt;?&gt; componentType, <span class="type">int</span> length)</span></span><br><span class="line">        <span class="keyword">throws</span> NegativeArraySizeException;</span><br></pre></td></tr></table></figure>

<p>源码目录：<code>openjdk\hotspot\src\share\vm\runtime\reflection.cpp</code></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">arrayOop <span class="title">Reflection::reflect_new_array</span><span class="params">(oop element_mirror, jint length, TRAPS)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (element_mirror == <span class="literal">NULL</span>) &#123;</span><br><span class="line">    <span class="built_in">THROW_0</span>(vmSymbols::<span class="built_in">java_lang_NullPointerException</span>());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (length &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">THROW_0</span>(vmSymbols::<span class="built_in">java_lang_NegativeArraySizeException</span>());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (java_lang_Class::<span class="built_in">is_primitive</span>(element_mirror)) &#123;</span><br><span class="line">    Klass* tak = <span class="built_in">basic_type_mirror_to_arrayklass</span>(element_mirror, CHECK_NULL);</span><br><span class="line">    <span class="keyword">return</span> TypeArrayKlass::<span class="built_in">cast</span>(tak)-&gt;<span class="built_in">allocate</span>(length, THREAD);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Klass* k = java_lang_Class::<span class="built_in">as_Klass</span>(element_mirror);</span><br><span class="line">    <span class="keyword">if</span> (k-&gt;<span class="built_in">oop_is_array</span>() &amp;&amp; ArrayKlass::<span class="built_in">cast</span>(k)-&gt;<span class="built_in">dimension</span>() &gt;= MAX_DIM) &#123;</span><br><span class="line">      <span class="built_in">THROW_0</span>(vmSymbols::<span class="built_in">java_lang_IllegalArgumentException</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> oopFactory::<span class="built_in">new_objArray</span>(k, length, THREAD);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另外，Array 类的 <code>set</code> 和 <code>get</code> 方法都为 native 方法，在 HotSpot JVM 里分别对应 <code>Reflection::array_set</code> 和 <code>Reflection::array_get</code> 方法，这里就不详细解析了。</p>
<h1 id="四、反射的一些注意事项"><a href="#四、反射的一些注意事项" class="headerlink" title="四、反射的一些注意事项"></a>四、反射的一些注意事项</h1><p>由于反射会额外消耗一定的系统资源，因此如果不需要动态地创建一个对象，那么就不需要用反射。</p>
<p>另外，反射调用方法时可以忽略权限检查，因此可能会破坏封装性而导致安全问题。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noarsark.github.io/2020/06/02/BCrypt%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%EF%BC%8C%E5%8F%B7%E7%A7%B0%E7%9B%AE%E5%89%8D%E6%9C%80%E5%AE%89%E5%85%A8%E7%9A%84%E7%AE%97%E6%B3%95%E4%B9%8B%E4%B8%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="noarsark">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="noarsark's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | noarsark's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/06/02/BCrypt%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%EF%BC%8C%E5%8F%B7%E7%A7%B0%E7%9B%AE%E5%89%8D%E6%9C%80%E5%AE%89%E5%85%A8%E7%9A%84%E7%AE%97%E6%B3%95%E4%B9%8B%E4%B8%80/" class="post-title-link" itemprop="url">BCrypt加密算法，号称目前最安全的算法之一</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-02 21:49:06" itemprop="dateCreated datePublished" datetime="2020-06-02T21:49:06+08:00">2020-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-12-22 22:24:10" itemprop="dateModified" datetime="2020-12-22T22:24:10+08:00">2020-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="一、哈希（Hash）与加密（Encrypt）"><a href="#一、哈希（Hash）与加密（Encrypt）" class="headerlink" title="一、哈希（Hash）与加密（Encrypt）"></a>一、哈希（Hash）与加密（Encrypt）</h1><p><strong>哈希（Hash）是将目标文本转换成具有相同长度的、不可逆的杂凑字符串（或叫做消息摘要），而加密（Encrypt）是将目标文本转换成具有不同长度的、可逆的密文。</strong></p>
<ol>
<li>哈希算法往往被设计成生成具有相同长度的文本，而加密算法生成的文本长度与明文本身的长度有关。</li>
<li>哈希算法是不可逆的，而加密算法是可逆的。</li>
</ol>
<p>HASH 算法是一种消息摘要算法，不是一种加密算法，但由于其单向运算，具有一定的不可逆性，成为加密算法中的一个构成部分。</p>
<p>JDK的String的Hash算法。代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> hash;</span><br><span class="line">    <span class="keyword">if</span> (h == <span class="number">0</span> &amp;&amp; value.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">char</span> val[] = value;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; value.length; i++) &#123;</span><br><span class="line">            h = <span class="number">31</span> * h + val[i];</span><br><span class="line">        &#125;</span><br><span class="line">        hash = h;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从JDK的API可以看出，它的算法等式就是s[0]*31^(n-1) + s[1]*31^(n-2) + … + s[n-1]，其中s[i]就是索引为i的字符，n为字符串的长度。</p>
<p>HashMap的hash计算时先计算hashCode(),然后进行二次hash。代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(<span class="type">int</span> h)</span> &#123;</span><br><span class="line">    h ^= (h &gt;&gt;&gt; <span class="number">20</span>) ^ (h &gt;&gt;&gt; <span class="number">12</span>);</span><br><span class="line">    <span class="keyword">return</span> h ^ (h &gt;&gt;&gt; <span class="number">7</span>) ^ (h &gt;&gt;&gt; <span class="number">4</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>大家可以发现，虽然算法不同，但经过这些移位操作后，对于同一个值使用同一个算法，计算出来的hash值一定是相同的。</p>
<h3 id="那么，hash为什么是不可逆的呢？"><a href="#那么，hash为什么是不可逆的呢？" class="headerlink" title="那么，hash为什么是不可逆的呢？"></a>那么，hash为什么是不可逆的呢？</h3><p>假如有两个密码3和4，我的加密算法很简单就是3+4，结果是7，但是通过7我不可能确定那两个密码是3和4，有很多种组合，这就是最简单的不可逆，所以只能通过<a target="_blank" rel="noopener" href="https://www.baidu.com/s?wd=%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3&tn=SE_PcZhidaonwhc_ngpagmjz&rsv_dl=gh_pc_zhidao">暴力破解</a>一个一个的试。</p>
<p>在计算过程中原文的部分信息是丢失了。一个MD5理论上是可以对应多个原文的，因为MD5是有限多个而原文是无限多个的。</p>
<h1 id="二、不可逆的MD5为什么是不安全的"><a href="#二、不可逆的MD5为什么是不安全的" class="headerlink" title="二、不可逆的MD5为什么是不安全的"></a>二、不可逆的MD5为什么是不安全的</h1><p>因为hash算法是固定的，所以同一个字符串计算出来的hash串是固定的，所以，可以采用如下的方式进行破解。</p>
<ol>
<li><strong>暴力枚举法：</strong>简单粗暴地枚举出所有原文，并计算出它们的哈希值，看看哪个哈希值和给定的信息摘要一致。</li>
<li><strong>字典法：</strong>黑客利用一个巨大的字典，存储尽可能多的原文和对应的哈希值。每次用给定的信息摘要查找字典，即可快速找到碰撞的结果。</li>
<li><strong>彩虹表（</strong>rainbow<strong>）法：</strong>在字典法的基础上改进，以时间换空间。是现在破解哈希常用的办法。</li>
</ol>
<p>对于单机来说，暴力枚举法的时间成本很高（以14位字母和数字的组合密码为例，共有1.24×10^25种可能，即使电脑每秒钟能进行10亿次运算，也需要4亿年才能破解），字典法的空间成本很高（仍以14位字母和数字的组合密码为例，生成的密码32位哈希串的对照表将占用5.7×10^14 TB的存储空间）。但是利用分布式计算和分布式存储，仍然可以有效破解MD5算法。因此这两种方法同样被黑客们广泛使用。</p>
<ul>
<li>2004年，王小云教授提出了非常高效的MD5碰撞方法。</li>
<li>2009年，冯登国、谢涛利用差分攻击，将MD5的碰撞算法复杂度进一步降低。</li>
</ul>
<h1 id="三、如何防御彩虹表的破解"><a href="#三、如何防御彩虹表的破解" class="headerlink" title="三、如何防御彩虹表的破解"></a>三、如何防御彩虹表的破解</h1><p>虽然彩虹表有着如此惊人的破解效率，但网站的安全人员仍然有办法防御彩虹表。最有效的方法就是“加盐”，即在密码的特定位置插入特定的字符串，这个特定字符串就是“盐（Salt）”，加盐后的密码经过哈希加密得到的哈希串与加盐前的哈希串完全不同，黑客用彩虹表得到的密码根本就不是真正的密码。即使黑客知道了“盐”的内容、加盐的位置，还需要对H函数和R函数进行修改，彩虹表也需要重新生成，因此加盐能大大增加利用彩虹表攻击的难度。</p>
<p>一个网站，如果加密算法和盐都泄露了，那针对性攻击依然是非常不安全的。因为同一个加密算法同一个盐加密后的字符串仍然还是一毛一样滴！</p>
<h1 id="四、一个更难破解的加密算法Bcrypt"><a href="#四、一个更难破解的加密算法Bcrypt" class="headerlink" title="四、一个更难破解的加密算法Bcrypt"></a>四、一个更难破解的加密算法Bcrypt</h1><p>Bcrypt是一种跨平台的文件加密工具。Bcrypt 使用的是布鲁斯·施内尔在1993年发布的 Blowfish 加密算法。由它加密的文件可在所有支持的操作系统和处理器上进行转移。它的口令必须是8至56个字符，并将在内部被转化为448位的密钥。</p>
<p>Bcrypt就是一款加密工具，可以比较方便地实现数据的加密工作。你也可以简单理解为它内部自己实现了随机加盐处理。使用Bcrypt，每次加密后的密文是不一样的。</p>
<p>对一个密码，Bcrypt每次生成的hash都不一样，那么它是如何进行校验的？</p>
<ol>
<li>虽然对同一个密码，每次生成的hash不一样，但是hash中包含了salt（hash产生过程：先随机生成salt，salt跟password进行hash）；</li>
<li>在下次校验时，从hash中取出salt，salt跟password进行hash；得到的结果跟保存在DB中的hash进行比对。</li>
</ol>
<p>BCrypt算法将salt随机并混入最终加密后的密码，验证时也无需单独提供之前的salt，从而无需单独处理salt问题。</p>
<p>salt随机部分代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据SecureRandom对象与gensalt()方法产生随机值</span></span><br><span class="line"><span class="type">String</span> <span class="variable">salt</span> <span class="operator">=</span> gensalt(xx, <span class="keyword">new</span> <span class="title class_">SecureRandom</span>());</span><br><span class="line"><span class="type">String</span> <span class="variable">BCpwd</span> <span class="operator">=</span> hashpw(<span class="string">&quot;123456&quot;</span>, salt);</span><br></pre></td></tr></table></figure>

<p>用法很简单：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//BCpwd是加密后的密文</span></span><br><span class="line"><span class="type">String</span> <span class="variable">BCpwd</span> <span class="operator">=</span> BCrypt.hashpw(password, BCrypt.gensalt());</span><br></pre></td></tr></table></figure>

<blockquote>
<p>加密后的格式一般为：</p>
<p>$2a$10$&#x2F;bTVvqqlH9UiE0ZJZ7N2Me3RIgUCdgMheyTgV0B4cMCSokPa.6oCa</p>
<p>其中：$是分割符，无意义；2a是bcrypt加密版本号；10是cost的值；而后的前22位是salt值；再然后的字符串就是密码的密文了。</p>
</blockquote>
<p>这块代码的格式拼接可以查看gensalt()方法源码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">gensalt</span><span class="params">(<span class="type">int</span> log_rounds, SecureRandom random)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (log_rounds &lt; <span class="number">4</span> || log_rounds &gt; <span class="number">31</span>) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Bad number of rounds&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">StringBuilder</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">	<span class="type">byte</span> rnd[] = <span class="keyword">new</span> <span class="title class_">byte</span>[BCRYPT_SALT_LEN];</span><br><span class="line"> </span><br><span class="line">	random.nextBytes(rnd);</span><br><span class="line"> </span><br><span class="line">	rs.append(<span class="string">&quot;$2a$&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (log_rounds &lt; <span class="number">10</span>) &#123;</span><br><span class="line">		rs.append(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	rs.append(log_rounds);</span><br><span class="line">	rs.append(<span class="string">&quot;$&quot;</span>);</span><br><span class="line">	encode_base64(rnd, rnd.length, rs);</span><br><span class="line">	<span class="keyword">return</span> rs.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>整理的一套BCrypt算法源码，可以很方便的直接拿来用：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> bcrypt;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.security.SecureRandom;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBCrypt</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Pattern</span> <span class="variable">BCRYPT_PATTERN</span> <span class="operator">=</span> Pattern</span><br><span class="line">			.compile(<span class="string">&quot;\\A\\$2a?\\$\\d\\d\\$[./0-9A-Za-z]&#123;53&#125;&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">GENSALT_DEFAULT_LOG2_ROUNDS</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BCRYPT_SALT_LEN</span> <span class="operator">=</span> <span class="number">16</span>;</span><br><span class="line">	<span class="comment">// Blowfish parameters</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BLOWFISH_NUM_ROUNDS</span> <span class="operator">=</span> <span class="number">16</span>;</span><br><span class="line">	<span class="comment">// Initial contents of key schedule</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> P_orig[] = &#123; <span class="number">0x243f6a88</span>, <span class="number">0x85a308d3</span>, <span class="number">0x13198a2e</span>, <span class="number">0x03707344</span>,</span><br><span class="line">			<span class="number">0xa4093822</span>, <span class="number">0x299f31d0</span>, <span class="number">0x082efa98</span>, <span class="number">0xec4e6c89</span>, <span class="number">0x452821e6</span>, <span class="number">0x38d01377</span>,</span><br><span class="line">			<span class="number">0xbe5466cf</span>, <span class="number">0x34e90c6c</span>, <span class="number">0xc0ac29b7</span>, <span class="number">0xc97c50dd</span>, <span class="number">0x3f84d5b5</span>, <span class="number">0xb5470917</span>,</span><br><span class="line">			<span class="number">0x9216d5d9</span>, <span class="number">0x8979fb1b</span> &#125;;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> S_orig[] = &#123; <span class="number">0xd1310ba6</span>, <span class="number">0x98dfb5ac</span>, <span class="number">0x2ffd72db</span>, <span class="number">0xd01adfb7</span>,</span><br><span class="line">			<span class="number">0xb8e1afed</span>, <span class="number">0x6a267e96</span>, <span class="number">0xba7c9045</span>, <span class="number">0xf12c7f99</span>, <span class="number">0x24a19947</span>, <span class="number">0xb3916cf7</span>,</span><br><span class="line">			<span class="number">0x0801f2e2</span>, <span class="number">0x858efc16</span>, <span class="number">0x636920d8</span>, <span class="number">0x71574e69</span>, <span class="number">0xa458fea3</span>, <span class="number">0xf4933d7e</span>,</span><br><span class="line">			<span class="number">0x0d95748f</span>, <span class="number">0x728eb658</span>, <span class="number">0x718bcd58</span>, <span class="number">0x82154aee</span>, <span class="number">0x7b54a41d</span>, <span class="number">0xc25a59b5</span>,</span><br><span class="line">			<span class="number">0x9c30d539</span>, <span class="number">0x2af26013</span>, <span class="number">0xc5d1b023</span>, <span class="number">0x286085f0</span>, <span class="number">0xca417918</span>, <span class="number">0xb8db38ef</span>,</span><br><span class="line">			<span class="number">0x8e79dcb0</span>, <span class="number">0x603a180e</span>, <span class="number">0x6c9e0e8b</span>, <span class="number">0xb01e8a3e</span>, <span class="number">0xd71577c1</span>, <span class="number">0xbd314b27</span>,</span><br><span class="line">			<span class="number">0x78af2fda</span>, <span class="number">0x55605c60</span>, <span class="number">0xe65525f3</span>, <span class="number">0xaa55ab94</span>, <span class="number">0x57489862</span>, <span class="number">0x63e81440</span>,</span><br><span class="line">			<span class="number">0x55ca396a</span>, <span class="number">0x2aab10b6</span>, <span class="number">0xb4cc5c34</span>, <span class="number">0x1141e8ce</span>, <span class="number">0xa15486af</span>, <span class="number">0x7c72e993</span>,</span><br><span class="line">			<span class="number">0xb3ee1411</span>, <span class="number">0x636fbc2a</span>, <span class="number">0x2ba9c55d</span>, <span class="number">0x741831f6</span>, <span class="number">0xce5c3e16</span>, <span class="number">0x9b87931e</span>,</span><br><span class="line">			<span class="number">0xafd6ba33</span>, <span class="number">0x6c24cf5c</span>, <span class="number">0x7a325381</span>, <span class="number">0x28958677</span>, <span class="number">0x3b8f4898</span>, <span class="number">0x6b4bb9af</span>,</span><br><span class="line">			<span class="number">0xc4bfe81b</span>, <span class="number">0x66282193</span>, <span class="number">0x61d809cc</span>, <span class="number">0xfb21a991</span>, <span class="number">0x487cac60</span>, <span class="number">0x5dec8032</span>,</span><br><span class="line">			<span class="number">0xef845d5d</span>, <span class="number">0xe98575b1</span>, <span class="number">0xdc262302</span>, <span class="number">0xeb651b88</span>, <span class="number">0x23893e81</span>, <span class="number">0xd396acc5</span>,</span><br><span class="line">			<span class="number">0x0f6d6ff3</span>, <span class="number">0x83f44239</span>, <span class="number">0x2e0b4482</span>, <span class="number">0xa4842004</span>, <span class="number">0x69c8f04a</span>, <span class="number">0x9e1f9b5e</span>,</span><br><span class="line">			<span class="number">0x21c66842</span>, <span class="number">0xf6e96c9a</span>, <span class="number">0x670c9c61</span>, <span class="number">0xabd388f0</span>, <span class="number">0x6a51a0d2</span>, <span class="number">0xd8542f68</span>,</span><br><span class="line">			<span class="number">0x960fa728</span>, <span class="number">0xab5133a3</span>, <span class="number">0x6eef0b6c</span>, <span class="number">0x137a3be4</span>, <span class="number">0xba3bf050</span>, <span class="number">0x7efb2a98</span>,</span><br><span class="line">			<span class="number">0xa1f1651d</span>, <span class="number">0x39af0176</span>, <span class="number">0x66ca593e</span>, <span class="number">0x82430e88</span>, <span class="number">0x8cee8619</span>, <span class="number">0x456f9fb4</span>,</span><br><span class="line">			<span class="number">0x7d84a5c3</span>, <span class="number">0x3b8b5ebe</span>, <span class="number">0xe06f75d8</span>, <span class="number">0x85c12073</span>, <span class="number">0x401a449f</span>, <span class="number">0x56c16aa6</span>,</span><br><span class="line">			<span class="number">0x4ed3aa62</span>, <span class="number">0x363f7706</span>, <span class="number">0x1bfedf72</span>, <span class="number">0x429b023d</span>, <span class="number">0x37d0d724</span>, <span class="number">0xd00a1248</span>,</span><br><span class="line">			<span class="number">0xdb0fead3</span>, <span class="number">0x49f1c09b</span>, <span class="number">0x075372c9</span>, <span class="number">0x80991b7b</span>, <span class="number">0x25d479d8</span>, <span class="number">0xf6e8def7</span>,</span><br><span class="line">			<span class="number">0xe3fe501a</span>, <span class="number">0xb6794c3b</span>, <span class="number">0x976ce0bd</span>, <span class="number">0x04c006ba</span>, <span class="number">0xc1a94fb6</span>, <span class="number">0x409f60c4</span>,</span><br><span class="line">			<span class="number">0x5e5c9ec2</span>, <span class="number">0x196a2463</span>, <span class="number">0x68fb6faf</span>, <span class="number">0x3e6c53b5</span>, <span class="number">0x1339b2eb</span>, <span class="number">0x3b52ec6f</span>,</span><br><span class="line">			<span class="number">0x6dfc511f</span>, <span class="number">0x9b30952c</span>, <span class="number">0xcc814544</span>, <span class="number">0xaf5ebd09</span>, <span class="number">0xbee3d004</span>, <span class="number">0xde334afd</span>,</span><br><span class="line">			<span class="number">0x660f2807</span>, <span class="number">0x192e4bb3</span>, <span class="number">0xc0cba857</span>, <span class="number">0x45c8740f</span>, <span class="number">0xd20b5f39</span>, <span class="number">0xb9d3fbdb</span>,</span><br><span class="line">			<span class="number">0x5579c0bd</span>, <span class="number">0x1a60320a</span>, <span class="number">0xd6a100c6</span>, <span class="number">0x402c7279</span>, <span class="number">0x679f25fe</span>, <span class="number">0xfb1fa3cc</span>,</span><br><span class="line">			<span class="number">0x8ea5e9f8</span>, <span class="number">0xdb3222f8</span>, <span class="number">0x3c7516df</span>, <span class="number">0xfd616b15</span>, <span class="number">0x2f501ec8</span>, <span class="number">0xad0552ab</span>,</span><br><span class="line">			<span class="number">0x323db5fa</span>, <span class="number">0xfd238760</span>, <span class="number">0x53317b48</span>, <span class="number">0x3e00df82</span>, <span class="number">0x9e5c57bb</span>, <span class="number">0xca6f8ca0</span>,</span><br><span class="line">			<span class="number">0x1a87562e</span>, <span class="number">0xdf1769db</span>, <span class="number">0xd542a8f6</span>, <span class="number">0x287effc3</span>, <span class="number">0xac6732c6</span>, <span class="number">0x8c4f5573</span>,</span><br><span class="line">			<span class="number">0x695b27b0</span>, <span class="number">0xbbca58c8</span>, <span class="number">0xe1ffa35d</span>, <span class="number">0xb8f011a0</span>, <span class="number">0x10fa3d98</span>, <span class="number">0xfd2183b8</span>,</span><br><span class="line">			<span class="number">0x4afcb56c</span>, <span class="number">0x2dd1d35b</span>, <span class="number">0x9a53e479</span>, <span class="number">0xb6f84565</span>, <span class="number">0xd28e49bc</span>, <span class="number">0x4bfb9790</span>,</span><br><span class="line">			<span class="number">0xe1ddf2da</span>, <span class="number">0xa4cb7e33</span>, <span class="number">0x62fb1341</span>, <span class="number">0xcee4c6e8</span>, <span class="number">0xef20cada</span>, <span class="number">0x36774c01</span>,</span><br><span class="line">			<span class="number">0xd07e9efe</span>, <span class="number">0x2bf11fb4</span>, <span class="number">0x95dbda4d</span>, <span class="number">0xae909198</span>, <span class="number">0xeaad8e71</span>, <span class="number">0x6b93d5a0</span>,</span><br><span class="line">			<span class="number">0xd08ed1d0</span>, <span class="number">0xafc725e0</span>, <span class="number">0x8e3c5b2f</span>, <span class="number">0x8e7594b7</span>, <span class="number">0x8ff6e2fb</span>, <span class="number">0xf2122b64</span>,</span><br><span class="line">			<span class="number">0x8888b812</span>, <span class="number">0x900df01c</span>, <span class="number">0x4fad5ea0</span>, <span class="number">0x688fc31c</span>, <span class="number">0xd1cff191</span>, <span class="number">0xb3a8c1ad</span>,</span><br><span class="line">			<span class="number">0x2f2f2218</span>, <span class="number">0xbe0e1777</span>, <span class="number">0xea752dfe</span>, <span class="number">0x8b021fa1</span>, <span class="number">0xe5a0cc0f</span>, <span class="number">0xb56f74e8</span>,</span><br><span class="line">			<span class="number">0x18acf3d6</span>, <span class="number">0xce89e299</span>, <span class="number">0xb4a84fe0</span>, <span class="number">0xfd13e0b7</span>, <span class="number">0x7cc43b81</span>, <span class="number">0xd2ada8d9</span>,</span><br><span class="line">			<span class="number">0x165fa266</span>, <span class="number">0x80957705</span>, <span class="number">0x93cc7314</span>, <span class="number">0x211a1477</span>, <span class="number">0xe6ad2065</span>, <span class="number">0x77b5fa86</span>,</span><br><span class="line">			<span class="number">0xc75442f5</span>, <span class="number">0xfb9d35cf</span>, <span class="number">0xebcdaf0c</span>, <span class="number">0x7b3e89a0</span>, <span class="number">0xd6411bd3</span>, <span class="number">0xae1e7e49</span>,</span><br><span class="line">			<span class="number">0x00250e2d</span>, <span class="number">0x2071b35e</span>, <span class="number">0x226800bb</span>, <span class="number">0x57b8e0af</span>, <span class="number">0x2464369b</span>, <span class="number">0xf009b91e</span>,</span><br><span class="line">			<span class="number">0x5563911d</span>, <span class="number">0x59dfa6aa</span>, <span class="number">0x78c14389</span>, <span class="number">0xd95a537f</span>, <span class="number">0x207d5ba2</span>, <span class="number">0x02e5b9c5</span>,</span><br><span class="line">			<span class="number">0x83260376</span>, <span class="number">0x6295cfa9</span>, <span class="number">0x11c81968</span>, <span class="number">0x4e734a41</span>, <span class="number">0xb3472dca</span>, <span class="number">0x7b14a94a</span>,</span><br><span class="line">			<span class="number">0x1b510052</span>, <span class="number">0x9a532915</span>, <span class="number">0xd60f573f</span>, <span class="number">0xbc9bc6e4</span>, <span class="number">0x2b60a476</span>, <span class="number">0x81e67400</span>,</span><br><span class="line">			<span class="number">0x08ba6fb5</span>, <span class="number">0x571be91f</span>, <span class="number">0xf296ec6b</span>, <span class="number">0x2a0dd915</span>, <span class="number">0xb6636521</span>, <span class="number">0xe7b9f9b6</span>,</span><br><span class="line">			<span class="number">0xff34052e</span>, <span class="number">0xc5855664</span>, <span class="number">0x53b02d5d</span>, <span class="number">0xa99f8fa1</span>, <span class="number">0x08ba4799</span>, <span class="number">0x6e85076a</span>,</span><br><span class="line">			<span class="number">0x4b7a70e9</span>, <span class="number">0xb5b32944</span>, <span class="number">0xdb75092e</span>, <span class="number">0xc4192623</span>, <span class="number">0xad6ea6b0</span>, <span class="number">0x49a7df7d</span>,</span><br><span class="line">			<span class="number">0x9cee60b8</span>, <span class="number">0x8fedb266</span>, <span class="number">0xecaa8c71</span>, <span class="number">0x699a17ff</span>, <span class="number">0x5664526c</span>, <span class="number">0xc2b19ee1</span>,</span><br><span class="line">			<span class="number">0x193602a5</span>, <span class="number">0x75094c29</span>, <span class="number">0xa0591340</span>, <span class="number">0xe4183a3e</span>, <span class="number">0x3f54989a</span>, <span class="number">0x5b429d65</span>,</span><br><span class="line">			<span class="number">0x6b8fe4d6</span>, <span class="number">0x99f73fd6</span>, <span class="number">0xa1d29c07</span>, <span class="number">0xefe830f5</span>, <span class="number">0x4d2d38e6</span>, <span class="number">0xf0255dc1</span>,</span><br><span class="line">			<span class="number">0x4cdd2086</span>, <span class="number">0x8470eb26</span>, <span class="number">0x6382e9c6</span>, <span class="number">0x021ecc5e</span>, <span class="number">0x09686b3f</span>, <span class="number">0x3ebaefc9</span>,</span><br><span class="line">			<span class="number">0x3c971814</span>, <span class="number">0x6b6a70a1</span>, <span class="number">0x687f3584</span>, <span class="number">0x52a0e286</span>, <span class="number">0xb79c5305</span>, <span class="number">0xaa500737</span>,</span><br><span class="line">			<span class="number">0x3e07841c</span>, <span class="number">0x7fdeae5c</span>, <span class="number">0x8e7d44ec</span>, <span class="number">0x5716f2b8</span>, <span class="number">0xb03ada37</span>, <span class="number">0xf0500c0d</span>,</span><br><span class="line">			<span class="number">0xf01c1f04</span>, <span class="number">0x0200b3ff</span>, <span class="number">0xae0cf51a</span>, <span class="number">0x3cb574b2</span>, <span class="number">0x25837a58</span>, <span class="number">0xdc0921bd</span>,</span><br><span class="line">			<span class="number">0xd19113f9</span>, <span class="number">0x7ca92ff6</span>, <span class="number">0x94324773</span>, <span class="number">0x22f54701</span>, <span class="number">0x3ae5e581</span>, <span class="number">0x37c2dadc</span>,</span><br><span class="line">			<span class="number">0xc8b57634</span>, <span class="number">0x9af3dda7</span>, <span class="number">0xa9446146</span>, <span class="number">0x0fd0030e</span>, <span class="number">0xecc8c73e</span>, <span class="number">0xa4751e41</span>,</span><br><span class="line">			<span class="number">0xe238cd99</span>, <span class="number">0x3bea0e2f</span>, <span class="number">0x3280bba1</span>, <span class="number">0x183eb331</span>, <span class="number">0x4e548b38</span>, <span class="number">0x4f6db908</span>,</span><br><span class="line">			<span class="number">0x6f420d03</span>, <span class="number">0xf60a04bf</span>, <span class="number">0x2cb81290</span>, <span class="number">0x24977c79</span>, <span class="number">0x5679b072</span>, <span class="number">0xbcaf89af</span>,</span><br><span class="line">			<span class="number">0xde9a771f</span>, <span class="number">0xd9930810</span>, <span class="number">0xb38bae12</span>, <span class="number">0xdccf3f2e</span>, <span class="number">0x5512721f</span>, <span class="number">0x2e6b7124</span>,</span><br><span class="line">			<span class="number">0x501adde6</span>, <span class="number">0x9f84cd87</span>, <span class="number">0x7a584718</span>, <span class="number">0x7408da17</span>, <span class="number">0xbc9f9abc</span>, <span class="number">0xe94b7d8c</span>,</span><br><span class="line">			<span class="number">0xec7aec3a</span>, <span class="number">0xdb851dfa</span>, <span class="number">0x63094366</span>, <span class="number">0xc464c3d2</span>, <span class="number">0xef1c1847</span>, <span class="number">0x3215d908</span>,</span><br><span class="line">			<span class="number">0xdd433b37</span>, <span class="number">0x24c2ba16</span>, <span class="number">0x12a14d43</span>, <span class="number">0x2a65c451</span>, <span class="number">0x50940002</span>, <span class="number">0x133ae4dd</span>,</span><br><span class="line">			<span class="number">0x71dff89e</span>, <span class="number">0x10314e55</span>, <span class="number">0x81ac77d6</span>, <span class="number">0x5f11199b</span>, <span class="number">0x043556f1</span>, <span class="number">0xd7a3c76b</span>,</span><br><span class="line">			<span class="number">0x3c11183b</span>, <span class="number">0x5924a509</span>, <span class="number">0xf28fe6ed</span>, <span class="number">0x97f1fbfa</span>, <span class="number">0x9ebabf2c</span>, <span class="number">0x1e153c6e</span>,</span><br><span class="line">			<span class="number">0x86e34570</span>, <span class="number">0xeae96fb1</span>, <span class="number">0x860e5e0a</span>, <span class="number">0x5a3e2ab3</span>, <span class="number">0x771fe71c</span>, <span class="number">0x4e3d06fa</span>,</span><br><span class="line">			<span class="number">0x2965dcb9</span>, <span class="number">0x99e71d0f</span>, <span class="number">0x803e89d6</span>, <span class="number">0x5266c825</span>, <span class="number">0x2e4cc978</span>, <span class="number">0x9c10b36a</span>,</span><br><span class="line">			<span class="number">0xc6150eba</span>, <span class="number">0x94e2ea78</span>, <span class="number">0xa5fc3c53</span>, <span class="number">0x1e0a2df4</span>, <span class="number">0xf2f74ea7</span>, <span class="number">0x361d2b3d</span>,</span><br><span class="line">			<span class="number">0x1939260f</span>, <span class="number">0x19c27960</span>, <span class="number">0x5223a708</span>, <span class="number">0xf71312b6</span>, <span class="number">0xebadfe6e</span>, <span class="number">0xeac31f66</span>,</span><br><span class="line">			<span class="number">0xe3bc4595</span>, <span class="number">0xa67bc883</span>, <span class="number">0xb17f37d1</span>, <span class="number">0x018cff28</span>, <span class="number">0xc332ddef</span>, <span class="number">0xbe6c5aa5</span>,</span><br><span class="line">			<span class="number">0x65582185</span>, <span class="number">0x68ab9802</span>, <span class="number">0xeecea50f</span>, <span class="number">0xdb2f953b</span>, <span class="number">0x2aef7dad</span>, <span class="number">0x5b6e2f84</span>,</span><br><span class="line">			<span class="number">0x1521b628</span>, <span class="number">0x29076170</span>, <span class="number">0xecdd4775</span>, <span class="number">0x619f1510</span>, <span class="number">0x13cca830</span>, <span class="number">0xeb61bd96</span>,</span><br><span class="line">			<span class="number">0x0334fe1e</span>, <span class="number">0xaa0363cf</span>, <span class="number">0xb5735c90</span>, <span class="number">0x4c70a239</span>, <span class="number">0xd59e9e0b</span>, <span class="number">0xcbaade14</span>,</span><br><span class="line">			<span class="number">0xeecc86bc</span>, <span class="number">0x60622ca7</span>, <span class="number">0x9cab5cab</span>, <span class="number">0xb2f3846e</span>, <span class="number">0x648b1eaf</span>, <span class="number">0x19bdf0ca</span>,</span><br><span class="line">			<span class="number">0xa02369b9</span>, <span class="number">0x655abb50</span>, <span class="number">0x40685a32</span>, <span class="number">0x3c2ab4b3</span>, <span class="number">0x319ee9d5</span>, <span class="number">0xc021b8f7</span>,</span><br><span class="line">			<span class="number">0x9b540b19</span>, <span class="number">0x875fa099</span>, <span class="number">0x95f7997e</span>, <span class="number">0x623d7da8</span>, <span class="number">0xf837889a</span>, <span class="number">0x97e32d77</span>,</span><br><span class="line">			<span class="number">0x11ed935f</span>, <span class="number">0x16681281</span>, <span class="number">0x0e358829</span>, <span class="number">0xc7e61fd6</span>, <span class="number">0x96dedfa1</span>, <span class="number">0x7858ba99</span>,</span><br><span class="line">			<span class="number">0x57f584a5</span>, <span class="number">0x1b227263</span>, <span class="number">0x9b83c3ff</span>, <span class="number">0x1ac24696</span>, <span class="number">0xcdb30aeb</span>, <span class="number">0x532e3054</span>,</span><br><span class="line">			<span class="number">0x8fd948e4</span>, <span class="number">0x6dbc3128</span>, <span class="number">0x58ebf2ef</span>, <span class="number">0x34c6ffea</span>, <span class="number">0xfe28ed61</span>, <span class="number">0xee7c3c73</span>,</span><br><span class="line">			<span class="number">0x5d4a14d9</span>, <span class="number">0xe864b7e3</span>, <span class="number">0x42105d14</span>, <span class="number">0x203e13e0</span>, <span class="number">0x45eee2b6</span>, <span class="number">0xa3aaabea</span>,</span><br><span class="line">			<span class="number">0xdb6c4f15</span>, <span class="number">0xfacb4fd0</span>, <span class="number">0xc742f442</span>, <span class="number">0xef6abbb5</span>, <span class="number">0x654f3b1d</span>, <span class="number">0x41cd2105</span>,</span><br><span class="line">			<span class="number">0xd81e799e</span>, <span class="number">0x86854dc7</span>, <span class="number">0xe44b476a</span>, <span class="number">0x3d816250</span>, <span class="number">0xcf62a1f2</span>, <span class="number">0x5b8d2646</span>,</span><br><span class="line">			<span class="number">0xfc8883a0</span>, <span class="number">0xc1c7b6a3</span>, <span class="number">0x7f1524c3</span>, <span class="number">0x69cb7492</span>, <span class="number">0x47848a0b</span>, <span class="number">0x5692b285</span>,</span><br><span class="line">			<span class="number">0x095bbf00</span>, <span class="number">0xad19489d</span>, <span class="number">0x1462b174</span>, <span class="number">0x23820e00</span>, <span class="number">0x58428d2a</span>, <span class="number">0x0c55f5ea</span>,</span><br><span class="line">			<span class="number">0x1dadf43e</span>, <span class="number">0x233f7061</span>, <span class="number">0x3372f092</span>, <span class="number">0x8d937e41</span>, <span class="number">0xd65fecf1</span>, <span class="number">0x6c223bdb</span>,</span><br><span class="line">			<span class="number">0x7cde3759</span>, <span class="number">0xcbee7460</span>, <span class="number">0x4085f2a7</span>, <span class="number">0xce77326e</span>, <span class="number">0xa6078084</span>, <span class="number">0x19f8509e</span>,</span><br><span class="line">			<span class="number">0xe8efd855</span>, <span class="number">0x61d99735</span>, <span class="number">0xa969a7aa</span>, <span class="number">0xc50c06c2</span>, <span class="number">0x5a04abfc</span>, <span class="number">0x800bcadc</span>,</span><br><span class="line">			<span class="number">0x9e447a2e</span>, <span class="number">0xc3453484</span>, <span class="number">0xfdd56705</span>, <span class="number">0x0e1e9ec9</span>, <span class="number">0xdb73dbd3</span>, <span class="number">0x105588cd</span>,</span><br><span class="line">			<span class="number">0x675fda79</span>, <span class="number">0xe3674340</span>, <span class="number">0xc5c43465</span>, <span class="number">0x713e38d8</span>, <span class="number">0x3d28f89e</span>, <span class="number">0xf16dff20</span>,</span><br><span class="line">			<span class="number">0x153e21e7</span>, <span class="number">0x8fb03d4a</span>, <span class="number">0xe6e39f2b</span>, <span class="number">0xdb83adf7</span>, <span class="number">0xe93d5a68</span>, <span class="number">0x948140f7</span>,</span><br><span class="line">			<span class="number">0xf64c261c</span>, <span class="number">0x94692934</span>, <span class="number">0x411520f7</span>, <span class="number">0x7602d4f7</span>, <span class="number">0xbcf46b2e</span>, <span class="number">0xd4a20068</span>,</span><br><span class="line">			<span class="number">0xd4082471</span>, <span class="number">0x3320f46a</span>, <span class="number">0x43b7d4b7</span>, <span class="number">0x500061af</span>, <span class="number">0x1e39f62e</span>, <span class="number">0x97244546</span>,</span><br><span class="line">			<span class="number">0x14214f74</span>, <span class="number">0xbf8b8840</span>, <span class="number">0x4d95fc1d</span>, <span class="number">0x96b591af</span>, <span class="number">0x70f4ddd3</span>, <span class="number">0x66a02f45</span>,</span><br><span class="line">			<span class="number">0xbfbc09ec</span>, <span class="number">0x03bd9785</span>, <span class="number">0x7fac6dd0</span>, <span class="number">0x31cb8504</span>, <span class="number">0x96eb27b3</span>, <span class="number">0x55fd3941</span>,</span><br><span class="line">			<span class="number">0xda2547e6</span>, <span class="number">0xabca0a9a</span>, <span class="number">0x28507825</span>, <span class="number">0x530429f4</span>, <span class="number">0x0a2c86da</span>, <span class="number">0xe9b66dfb</span>,</span><br><span class="line">			<span class="number">0x68dc1462</span>, <span class="number">0xd7486900</span>, <span class="number">0x680ec0a4</span>, <span class="number">0x27a18dee</span>, <span class="number">0x4f3ffea2</span>, <span class="number">0xe887ad8c</span>,</span><br><span class="line">			<span class="number">0xb58ce006</span>, <span class="number">0x7af4d6b6</span>, <span class="number">0xaace1e7c</span>, <span class="number">0xd3375fec</span>, <span class="number">0xce78a399</span>, <span class="number">0x406b2a42</span>,</span><br><span class="line">			<span class="number">0x20fe9e35</span>, <span class="number">0xd9f385b9</span>, <span class="number">0xee39d7ab</span>, <span class="number">0x3b124e8b</span>, <span class="number">0x1dc9faf7</span>, <span class="number">0x4b6d1856</span>,</span><br><span class="line">			<span class="number">0x26a36631</span>, <span class="number">0xeae397b2</span>, <span class="number">0x3a6efa74</span>, <span class="number">0xdd5b4332</span>, <span class="number">0x6841e7f7</span>, <span class="number">0xca7820fb</span>,</span><br><span class="line">			<span class="number">0xfb0af54e</span>, <span class="number">0xd8feb397</span>, <span class="number">0x454056ac</span>, <span class="number">0xba489527</span>, <span class="number">0x55533a3a</span>, <span class="number">0x20838d87</span>,</span><br><span class="line">			<span class="number">0xfe6ba9b7</span>, <span class="number">0xd096954b</span>, <span class="number">0x55a867bc</span>, <span class="number">0xa1159a58</span>, <span class="number">0xcca92963</span>, <span class="number">0x99e1db33</span>,</span><br><span class="line">			<span class="number">0xa62a4a56</span>, <span class="number">0x3f3125f9</span>, <span class="number">0x5ef47e1c</span>, <span class="number">0x9029317c</span>, <span class="number">0xfdf8e802</span>, <span class="number">0x04272f70</span>,</span><br><span class="line">			<span class="number">0x80bb155c</span>, <span class="number">0x05282ce3</span>, <span class="number">0x95c11548</span>, <span class="number">0xe4c66d22</span>, <span class="number">0x48c1133f</span>, <span class="number">0xc70f86dc</span>,</span><br><span class="line">			<span class="number">0x07f9c9ee</span>, <span class="number">0x41041f0f</span>, <span class="number">0x404779a4</span>, <span class="number">0x5d886e17</span>, <span class="number">0x325f51eb</span>, <span class="number">0xd59bc0d1</span>,</span><br><span class="line">			<span class="number">0xf2bcc18f</span>, <span class="number">0x41113564</span>, <span class="number">0x257b7834</span>, <span class="number">0x602a9c60</span>, <span class="number">0xdff8e8a3</span>, <span class="number">0x1f636c1b</span>,</span><br><span class="line">			<span class="number">0x0e12b4c2</span>, <span class="number">0x02e1329e</span>, <span class="number">0xaf664fd1</span>, <span class="number">0xcad18115</span>, <span class="number">0x6b2395e0</span>, <span class="number">0x333e92e1</span>,</span><br><span class="line">			<span class="number">0x3b240b62</span>, <span class="number">0xeebeb922</span>, <span class="number">0x85b2a20e</span>, <span class="number">0xe6ba0d99</span>, <span class="number">0xde720c8c</span>, <span class="number">0x2da2f728</span>,</span><br><span class="line">			<span class="number">0xd0127845</span>, <span class="number">0x95b794fd</span>, <span class="number">0x647d0862</span>, <span class="number">0xe7ccf5f0</span>, <span class="number">0x5449a36f</span>, <span class="number">0x877d48fa</span>,</span><br><span class="line">			<span class="number">0xc39dfd27</span>, <span class="number">0xf33e8d1e</span>, <span class="number">0x0a476341</span>, <span class="number">0x992eff74</span>, <span class="number">0x3a6f6eab</span>, <span class="number">0xf4f8fd37</span>,</span><br><span class="line">			<span class="number">0xa812dc60</span>, <span class="number">0xa1ebddf8</span>, <span class="number">0x991be14c</span>, <span class="number">0xdb6e6b0d</span>, <span class="number">0xc67b5510</span>, <span class="number">0x6d672c37</span>,</span><br><span class="line">			<span class="number">0x2765d43b</span>, <span class="number">0xdcd0e804</span>, <span class="number">0xf1290dc7</span>, <span class="number">0xcc00ffa3</span>, <span class="number">0xb5390f92</span>, <span class="number">0x690fed0b</span>,</span><br><span class="line">			<span class="number">0x667b9ffb</span>, <span class="number">0xcedb7d9c</span>, <span class="number">0xa091cf0b</span>, <span class="number">0xd9155ea3</span>, <span class="number">0xbb132f88</span>, <span class="number">0x515bad24</span>,</span><br><span class="line">			<span class="number">0x7b9479bf</span>, <span class="number">0x763bd6eb</span>, <span class="number">0x37392eb3</span>, <span class="number">0xcc115979</span>, <span class="number">0x8026e297</span>, <span class="number">0xf42e312d</span>,</span><br><span class="line">			<span class="number">0x6842ada7</span>, <span class="number">0xc66a2b3b</span>, <span class="number">0x12754ccc</span>, <span class="number">0x782ef11c</span>, <span class="number">0x6a124237</span>, <span class="number">0xb79251e7</span>,</span><br><span class="line">			<span class="number">0x06a1bbe6</span>, <span class="number">0x4bfb6350</span>, <span class="number">0x1a6b1018</span>, <span class="number">0x11caedfa</span>, <span class="number">0x3d25bdd8</span>, <span class="number">0xe2e1c3c9</span>,</span><br><span class="line">			<span class="number">0x44421659</span>, <span class="number">0x0a121386</span>, <span class="number">0xd90cec6e</span>, <span class="number">0xd5abea2a</span>, <span class="number">0x64af674e</span>, <span class="number">0xda86a85f</span>,</span><br><span class="line">			<span class="number">0xbebfe988</span>, <span class="number">0x64e4c3fe</span>, <span class="number">0x9dbc8057</span>, <span class="number">0xf0f7c086</span>, <span class="number">0x60787bf8</span>, <span class="number">0x6003604d</span>,</span><br><span class="line">			<span class="number">0xd1fd8346</span>, <span class="number">0xf6381fb0</span>, <span class="number">0x7745ae04</span>, <span class="number">0xd736fccc</span>, <span class="number">0x83426b33</span>, <span class="number">0xf01eab71</span>,</span><br><span class="line">			<span class="number">0xb0804187</span>, <span class="number">0x3c005e5f</span>, <span class="number">0x77a057be</span>, <span class="number">0xbde8ae24</span>, <span class="number">0x55464299</span>, <span class="number">0xbf582e61</span>,</span><br><span class="line">			<span class="number">0x4e58f48f</span>, <span class="number">0xf2ddfda2</span>, <span class="number">0xf474ef38</span>, <span class="number">0x8789bdc2</span>, <span class="number">0x5366f9c3</span>, <span class="number">0xc8b38e74</span>,</span><br><span class="line">			<span class="number">0xb475f255</span>, <span class="number">0x46fcd9b9</span>, <span class="number">0x7aeb2661</span>, <span class="number">0x8b1ddf84</span>, <span class="number">0x846a0e79</span>, <span class="number">0x915f95e2</span>,</span><br><span class="line">			<span class="number">0x466e598e</span>, <span class="number">0x20b45770</span>, <span class="number">0x8cd55591</span>, <span class="number">0xc902de4c</span>, <span class="number">0xb90bace1</span>, <span class="number">0xbb8205d0</span>,</span><br><span class="line">			<span class="number">0x11a86248</span>, <span class="number">0x7574a99e</span>, <span class="number">0xb77f19b6</span>, <span class="number">0xe0a9dc09</span>, <span class="number">0x662d09a1</span>, <span class="number">0xc4324633</span>,</span><br><span class="line">			<span class="number">0xe85a1f02</span>, <span class="number">0x09f0be8c</span>, <span class="number">0x4a99a025</span>, <span class="number">0x1d6efe10</span>, <span class="number">0x1ab93d1d</span>, <span class="number">0x0ba5a4df</span>,</span><br><span class="line">			<span class="number">0xa186f20f</span>, <span class="number">0x2868f169</span>, <span class="number">0xdcb7da83</span>, <span class="number">0x573906fe</span>, <span class="number">0xa1e2ce9b</span>, <span class="number">0x4fcd7f52</span>,</span><br><span class="line">			<span class="number">0x50115e01</span>, <span class="number">0xa70683fa</span>, <span class="number">0xa002b5c4</span>, <span class="number">0x0de6d027</span>, <span class="number">0x9af88c27</span>, <span class="number">0x773f8641</span>,</span><br><span class="line">			<span class="number">0xc3604c06</span>, <span class="number">0x61a806b5</span>, <span class="number">0xf0177a28</span>, <span class="number">0xc0f586e0</span>, <span class="number">0x006058aa</span>, <span class="number">0x30dc7d62</span>,</span><br><span class="line">			<span class="number">0x11e69ed7</span>, <span class="number">0x2338ea63</span>, <span class="number">0x53c2dd94</span>, <span class="number">0xc2c21634</span>, <span class="number">0xbbcbee56</span>, <span class="number">0x90bcb6de</span>,</span><br><span class="line">			<span class="number">0xebfc7da1</span>, <span class="number">0xce591d76</span>, <span class="number">0x6f05e409</span>, <span class="number">0x4b7c0188</span>, <span class="number">0x39720a3d</span>, <span class="number">0x7c927c24</span>,</span><br><span class="line">			<span class="number">0x86e3725f</span>, <span class="number">0x724d9db9</span>, <span class="number">0x1ac15bb4</span>, <span class="number">0xd39eb8fc</span>, <span class="number">0xed545578</span>, <span class="number">0x08fca5b5</span>,</span><br><span class="line">			<span class="number">0xd83d7cd3</span>, <span class="number">0x4dad0fc4</span>, <span class="number">0x1e50ef5e</span>, <span class="number">0xb161e6f8</span>, <span class="number">0xa28514d9</span>, <span class="number">0x6c51133c</span>,</span><br><span class="line">			<span class="number">0x6fd5c7e7</span>, <span class="number">0x56e14ec4</span>, <span class="number">0x362abfce</span>, <span class="number">0xddc6c837</span>, <span class="number">0xd79a3234</span>, <span class="number">0x92638212</span>,</span><br><span class="line">			<span class="number">0x670efa8e</span>, <span class="number">0x406000e0</span>, <span class="number">0x3a39ce37</span>, <span class="number">0xd3faf5cf</span>, <span class="number">0xabc27737</span>, <span class="number">0x5ac52d1b</span>,</span><br><span class="line">			<span class="number">0x5cb0679e</span>, <span class="number">0x4fa33742</span>, <span class="number">0xd3822740</span>, <span class="number">0x99bc9bbe</span>, <span class="number">0xd5118e9d</span>, <span class="number">0xbf0f7315</span>,</span><br><span class="line">			<span class="number">0xd62d1c7e</span>, <span class="number">0xc700c47b</span>, <span class="number">0xb78c1b6b</span>, <span class="number">0x21a19045</span>, <span class="number">0xb26eb1be</span>, <span class="number">0x6a366eb4</span>,</span><br><span class="line">			<span class="number">0x5748ab2f</span>, <span class="number">0xbc946e79</span>, <span class="number">0xc6a376d2</span>, <span class="number">0x6549c2c8</span>, <span class="number">0x530ff8ee</span>, <span class="number">0x468dde7d</span>,</span><br><span class="line">			<span class="number">0xd5730a1d</span>, <span class="number">0x4cd04dc6</span>, <span class="number">0x2939bbdb</span>, <span class="number">0xa9ba4650</span>, <span class="number">0xac9526e8</span>, <span class="number">0xbe5ee304</span>,</span><br><span class="line">			<span class="number">0xa1fad5f0</span>, <span class="number">0x6a2d519a</span>, <span class="number">0x63ef8ce2</span>, <span class="number">0x9a86ee22</span>, <span class="number">0xc089c2b8</span>, <span class="number">0x43242ef6</span>,</span><br><span class="line">			<span class="number">0xa51e03aa</span>, <span class="number">0x9cf2d0a4</span>, <span class="number">0x83c061ba</span>, <span class="number">0x9be96a4d</span>, <span class="number">0x8fe51550</span>, <span class="number">0xba645bd6</span>,</span><br><span class="line">			<span class="number">0x2826a2f9</span>, <span class="number">0xa73a3ae1</span>, <span class="number">0x4ba99586</span>, <span class="number">0xef5562e9</span>, <span class="number">0xc72fefd3</span>, <span class="number">0xf752f7da</span>,</span><br><span class="line">			<span class="number">0x3f046f69</span>, <span class="number">0x77fa0a59</span>, <span class="number">0x80e4a915</span>, <span class="number">0x87b08601</span>, <span class="number">0x9b09e6ad</span>, <span class="number">0x3b3ee593</span>,</span><br><span class="line">			<span class="number">0xe990fd5a</span>, <span class="number">0x9e34d797</span>, <span class="number">0x2cf0b7d9</span>, <span class="number">0x022b8b51</span>, <span class="number">0x96d5ac3a</span>, <span class="number">0x017da67d</span>,</span><br><span class="line">			<span class="number">0xd1cf3ed6</span>, <span class="number">0x7c7d2d28</span>, <span class="number">0x1f9f25cf</span>, <span class="number">0xadf2b89b</span>, <span class="number">0x5ad6b472</span>, <span class="number">0x5a88f54c</span>,</span><br><span class="line">			<span class="number">0xe029ac71</span>, <span class="number">0xe019a5e6</span>, <span class="number">0x47b0acfd</span>, <span class="number">0xed93fa9b</span>, <span class="number">0xe8d3c48d</span>, <span class="number">0x283b57cc</span>,</span><br><span class="line">			<span class="number">0xf8d56629</span>, <span class="number">0x79132e28</span>, <span class="number">0x785f0191</span>, <span class="number">0xed756055</span>, <span class="number">0xf7960e44</span>, <span class="number">0xe3d35e8c</span>,</span><br><span class="line">			<span class="number">0x15056dd4</span>, <span class="number">0x88f46dba</span>, <span class="number">0x03a16125</span>, <span class="number">0x0564f0bd</span>, <span class="number">0xc3eb9e15</span>, <span class="number">0x3c9057a2</span>,</span><br><span class="line">			<span class="number">0x97271aec</span>, <span class="number">0xa93a072a</span>, <span class="number">0x1b3f6d9b</span>, <span class="number">0x1e6321f5</span>, <span class="number">0xf59c66fb</span>, <span class="number">0x26dcf319</span>,</span><br><span class="line">			<span class="number">0x7533d928</span>, <span class="number">0xb155fdf5</span>, <span class="number">0x03563482</span>, <span class="number">0x8aba3cbb</span>, <span class="number">0x28517711</span>, <span class="number">0xc20ad9f8</span>,</span><br><span class="line">			<span class="number">0xabcc5167</span>, <span class="number">0xccad925f</span>, <span class="number">0x4de81751</span>, <span class="number">0x3830dc8e</span>, <span class="number">0x379d5862</span>, <span class="number">0x9320f991</span>,</span><br><span class="line">			<span class="number">0xea7a90c2</span>, <span class="number">0xfb3e7bce</span>, <span class="number">0x5121ce64</span>, <span class="number">0x774fbe32</span>, <span class="number">0xa8b6e37e</span>, <span class="number">0xc3293d46</span>,</span><br><span class="line">			<span class="number">0x48de5369</span>, <span class="number">0x6413e680</span>, <span class="number">0xa2ae0810</span>, <span class="number">0xdd6db224</span>, <span class="number">0x69852dfd</span>, <span class="number">0x09072166</span>,</span><br><span class="line">			<span class="number">0xb39a460a</span>, <span class="number">0x6445c0dd</span>, <span class="number">0x586cdecf</span>, <span class="number">0x1c20c8ae</span>, <span class="number">0x5bbef7dd</span>, <span class="number">0x1b588d40</span>,</span><br><span class="line">			<span class="number">0xccd2017f</span>, <span class="number">0x6bb4e3bb</span>, <span class="number">0xdda26a7e</span>, <span class="number">0x3a59ff45</span>, <span class="number">0x3e350a44</span>, <span class="number">0xbcb4cdd5</span>,</span><br><span class="line">			<span class="number">0x72eacea8</span>, <span class="number">0xfa6484bb</span>, <span class="number">0x8d6612ae</span>, <span class="number">0xbf3c6f47</span>, <span class="number">0xd29be463</span>, <span class="number">0x542f5d9e</span>,</span><br><span class="line">			<span class="number">0xaec2771b</span>, <span class="number">0xf64e6370</span>, <span class="number">0x740e0d8d</span>, <span class="number">0xe75b1357</span>, <span class="number">0xf8721671</span>, <span class="number">0xaf537d5d</span>,</span><br><span class="line">			<span class="number">0x4040cb08</span>, <span class="number">0x4eb4e2cc</span>, <span class="number">0x34d2466a</span>, <span class="number">0x0115af84</span>, <span class="number">0xe1b00428</span>, <span class="number">0x95983a1d</span>,</span><br><span class="line">			<span class="number">0x06b89fb4</span>, <span class="number">0xce6ea048</span>, <span class="number">0x6f3f3b82</span>, <span class="number">0x3520ab82</span>, <span class="number">0x011a1d4b</span>, <span class="number">0x277227f8</span>,</span><br><span class="line">			<span class="number">0x611560b1</span>, <span class="number">0xe7933fdc</span>, <span class="number">0xbb3a792b</span>, <span class="number">0x344525bd</span>, <span class="number">0xa08839e1</span>, <span class="number">0x51ce794b</span>,</span><br><span class="line">			<span class="number">0x2f32c9b7</span>, <span class="number">0xa01fbac9</span>, <span class="number">0xe01cc87e</span>, <span class="number">0xbcc7d1f6</span>, <span class="number">0xcf0111c3</span>, <span class="number">0xa1e8aac7</span>,</span><br><span class="line">			<span class="number">0x1a908749</span>, <span class="number">0xd44fbd9a</span>, <span class="number">0xd0dadecb</span>, <span class="number">0xd50ada38</span>, <span class="number">0x0339c32a</span>, <span class="number">0xc6913667</span>,</span><br><span class="line">			<span class="number">0x8df9317c</span>, <span class="number">0xe0b12b4f</span>, <span class="number">0xf79e59b7</span>, <span class="number">0x43f5bb3a</span>, <span class="number">0xf2d519ff</span>, <span class="number">0x27d9459c</span>,</span><br><span class="line">			<span class="number">0xbf97222c</span>, <span class="number">0x15e6fc2a</span>, <span class="number">0x0f91fc71</span>, <span class="number">0x9b941525</span>, <span class="number">0xfae59361</span>, <span class="number">0xceb69ceb</span>,</span><br><span class="line">			<span class="number">0xc2a86459</span>, <span class="number">0x12baa8d1</span>, <span class="number">0xb6c1075e</span>, <span class="number">0xe3056a0c</span>, <span class="number">0x10d25065</span>, <span class="number">0xcb03a442</span>,</span><br><span class="line">			<span class="number">0xe0ec6e0e</span>, <span class="number">0x1698db3b</span>, <span class="number">0x4c98a0be</span>, <span class="number">0x3278e964</span>, <span class="number">0x9f1f9532</span>, <span class="number">0xe0d392df</span>,</span><br><span class="line">			<span class="number">0xd3a0342b</span>, <span class="number">0x8971f21e</span>, <span class="number">0x1b0a7441</span>, <span class="number">0x4ba3348c</span>, <span class="number">0xc5be7120</span>, <span class="number">0xc37632d8</span>,</span><br><span class="line">			<span class="number">0xdf359f8d</span>, <span class="number">0x9b992f2e</span>, <span class="number">0xe60b6f47</span>, <span class="number">0x0fe3f11d</span>, <span class="number">0xe54cda54</span>, <span class="number">0x1edad891</span>,</span><br><span class="line">			<span class="number">0xce6279cf</span>, <span class="number">0xcd3e7e6f</span>, <span class="number">0x1618b166</span>, <span class="number">0xfd2c1d05</span>, <span class="number">0x848fd2c5</span>, <span class="number">0xf6fb2299</span>,</span><br><span class="line">			<span class="number">0xf523f357</span>, <span class="number">0xa6327623</span>, <span class="number">0x93a83531</span>, <span class="number">0x56cccd02</span>, <span class="number">0xacf08162</span>, <span class="number">0x5a75ebb5</span>,</span><br><span class="line">			<span class="number">0x6e163697</span>, <span class="number">0x88d273cc</span>, <span class="number">0xde966292</span>, <span class="number">0x81b949d0</span>, <span class="number">0x4c50901b</span>, <span class="number">0x71c65614</span>,</span><br><span class="line">			<span class="number">0xe6c6c7bd</span>, <span class="number">0x327a140a</span>, <span class="number">0x45e1d006</span>, <span class="number">0xc3f27b9a</span>, <span class="number">0xc9aa53fd</span>, <span class="number">0x62a80f00</span>,</span><br><span class="line">			<span class="number">0xbb25bfe2</span>, <span class="number">0x35bdd2f6</span>, <span class="number">0x71126905</span>, <span class="number">0xb2040222</span>, <span class="number">0xb6cbcf7c</span>, <span class="number">0xcd769c2b</span>,</span><br><span class="line">			<span class="number">0x53113ec0</span>, <span class="number">0x1640e3d3</span>, <span class="number">0x38abbd60</span>, <span class="number">0x2547adf0</span>, <span class="number">0xba38209c</span>, <span class="number">0xf746ce76</span>,</span><br><span class="line">			<span class="number">0x77afa1c5</span>, <span class="number">0x20756060</span>, <span class="number">0x85cbfe4e</span>, <span class="number">0x8ae88dd8</span>, <span class="number">0x7aaaf9b0</span>, <span class="number">0x4cf9aa7e</span>,</span><br><span class="line">			<span class="number">0x1948c25c</span>, <span class="number">0x02fb8a8c</span>, <span class="number">0x01c36ae4</span>, <span class="number">0xd6ebe1f9</span>, <span class="number">0x90d4f869</span>, <span class="number">0xa65cdea0</span>,</span><br><span class="line">			<span class="number">0x3f09252d</span>, <span class="number">0xc208e69f</span>, <span class="number">0xb74e6132</span>, <span class="number">0xce77e25b</span>, <span class="number">0x578fdfe3</span>, <span class="number">0x3ac372e6</span> &#125;;</span><br><span class="line">	<span class="comment">// bcrypt IV: &quot;OrpheanBeholderScryDoubt&quot;</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> bf_crypt_ciphertext[] = &#123; <span class="number">0x4f727068</span>, <span class="number">0x65616e42</span>,</span><br><span class="line">			<span class="number">0x65686f6c</span>, <span class="number">0x64657253</span>, <span class="number">0x63727944</span>, <span class="number">0x6f756274</span> &#125;;</span><br><span class="line">	<span class="comment">// Table for Base64 encoding</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">char</span> base64_code[] = &#123; <span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>,</span><br><span class="line">			<span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;U&#x27;</span>,</span><br><span class="line">			<span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;j&#x27;</span>,</span><br><span class="line">			<span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>,</span><br><span class="line">			<span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span> &#125;;</span><br><span class="line">	<span class="comment">// Table for Base64 decoding</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">byte</span> index_64[] = &#123; -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>,</span><br><span class="line">			-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>,</span><br><span class="line">			-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">54</span>, <span class="number">55</span>,</span><br><span class="line">			<span class="number">56</span>, <span class="number">57</span>, <span class="number">58</span>, <span class="number">59</span>, <span class="number">60</span>, <span class="number">61</span>, <span class="number">62</span>, <span class="number">63</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>,</span><br><span class="line">			<span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>,</span><br><span class="line">			-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">35</span>, <span class="number">36</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">39</span>, <span class="number">40</span>,</span><br><span class="line">			<span class="number">41</span>, <span class="number">42</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">45</span>, <span class="number">46</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="number">49</span>, <span class="number">50</span>, <span class="number">51</span>, <span class="number">52</span>, <span class="number">53</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span> &#125;;</span><br><span class="line">	<span class="comment">// Expanded Blowfish key</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> P[];</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> S[];</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="comment">//10是不确定的  此处只是个例子</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">salt</span> <span class="operator">=</span> gensalt(<span class="number">10</span>, <span class="keyword">new</span> <span class="title class_">SecureRandom</span>());</span><br><span class="line">		<span class="comment">//对123456加密</span></span><br><span class="line">		System.out.println(hashpw(<span class="string">&quot;123456&quot;</span>, salt));</span><br><span class="line">		<span class="comment">//是否匹配</span></span><br><span class="line">		System.out.println(matches(<span class="string">&quot;123456&quot;</span>, <span class="string">&quot;$2a$10$/bTVvqqlH9UiE0ZJZ7N2Me3RIgUCdgMheyTgV0B4cMCSokPa.6oCa&quot;</span>));</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">init_key</span><span class="params">()</span> &#123;</span><br><span class="line">		P = (<span class="type">int</span>[]) P_orig.clone();</span><br><span class="line">		S = (<span class="type">int</span>[]) S_orig.clone();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">encode_base64</span><span class="params">(<span class="type">byte</span> d[], <span class="type">int</span> len, StringBuilder rs)</span></span><br><span class="line">			<span class="keyword">throws</span> IllegalArgumentException &#123;</span><br><span class="line">		<span class="type">int</span> <span class="variable">off</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">		<span class="type">int</span> c1, c2;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">if</span> (len &lt;= <span class="number">0</span> || len &gt; d.length) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Invalid len&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">while</span> (off &lt; len) &#123;</span><br><span class="line">			c1 = d[off++] &amp; <span class="number">0xff</span>;</span><br><span class="line">			rs.append(base64_code[(c1 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">0x3f</span>]);</span><br><span class="line">			c1 = (c1 &amp; <span class="number">0x03</span>) &lt;&lt; <span class="number">4</span>;</span><br><span class="line">			<span class="keyword">if</span> (off &gt;= len) &#123;</span><br><span class="line">				rs.append(base64_code[c1 &amp; <span class="number">0x3f</span>]);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			c2 = d[off++] &amp; <span class="number">0xff</span>;</span><br><span class="line">			c1 |= (c2 &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0x0f</span>;</span><br><span class="line">			rs.append(base64_code[c1 &amp; <span class="number">0x3f</span>]);</span><br><span class="line">			c1 = (c2 &amp; <span class="number">0x0f</span>) &lt;&lt; <span class="number">2</span>;</span><br><span class="line">			<span class="keyword">if</span> (off &gt;= len) &#123;</span><br><span class="line">				rs.append(base64_code[c1 &amp; <span class="number">0x3f</span>]);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			c2 = d[off++] &amp; <span class="number">0xff</span>;</span><br><span class="line">			c1 |= (c2 &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x03</span>;</span><br><span class="line">			rs.append(base64_code[c1 &amp; <span class="number">0x3f</span>]);</span><br><span class="line">			rs.append(base64_code[c2 &amp; <span class="number">0x3f</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">static</span> <span class="type">byte</span>[] decode_base64(String s, <span class="type">int</span> maxolen) <span class="keyword">throws</span> IllegalArgumentException &#123;</span><br><span class="line">		<span class="type">ByteArrayOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>(maxolen);</span><br><span class="line">		<span class="type">int</span> <span class="variable">off</span> <span class="operator">=</span> <span class="number">0</span>, slen = s.length(), olen = <span class="number">0</span>;</span><br><span class="line">		<span class="type">byte</span> c1, c2, c3, c4, o;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">if</span> (maxolen &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Invalid maxolen&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">while</span> (off &lt; slen - <span class="number">1</span> &amp;&amp; olen &lt; maxolen) &#123;</span><br><span class="line">			c1 = char64(s.charAt(off++));</span><br><span class="line">			c2 = char64(s.charAt(off++));</span><br><span class="line">			<span class="keyword">if</span> (c1 == -<span class="number">1</span> || c2 == -<span class="number">1</span>) &#123;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			o = (<span class="type">byte</span>) (c1 &lt;&lt; <span class="number">2</span>);</span><br><span class="line">			o |= (c2 &amp; <span class="number">0x30</span>) &gt;&gt; <span class="number">4</span>;</span><br><span class="line">			out.write(o);</span><br><span class="line">			<span class="keyword">if</span> (++olen &gt;= maxolen || off &gt;= slen) &#123;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			c3 = char64(s.charAt(off++));</span><br><span class="line">			<span class="keyword">if</span> (c3 == -<span class="number">1</span>) &#123;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			o = (<span class="type">byte</span>) ((c2 &amp; <span class="number">0x0f</span>) &lt;&lt; <span class="number">4</span>);</span><br><span class="line">			o |= (c3 &amp; <span class="number">0x3c</span>) &gt;&gt; <span class="number">2</span>;</span><br><span class="line">			out.write(o);</span><br><span class="line">			<span class="keyword">if</span> (++olen &gt;= maxolen || off &gt;= slen) &#123;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			c4 = char64(s.charAt(off++));</span><br><span class="line">			o = (<span class="type">byte</span>) ((c3 &amp; <span class="number">0x03</span>) &lt;&lt; <span class="number">6</span>);</span><br><span class="line">			o |= c4;</span><br><span class="line">			out.write(o);</span><br><span class="line">			++olen;</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">return</span> out.toByteArray();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="type">byte</span> <span class="title function_">char64</span><span class="params">(<span class="type">char</span> x)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (x &gt; index_64.length) &#123;</span><br><span class="line">			<span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> index_64[x];</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">gensalt</span><span class="params">(<span class="type">int</span> log_rounds, SecureRandom random)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (log_rounds &lt; <span class="number">4</span> || log_rounds &gt; <span class="number">31</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Bad number of rounds&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">StringBuilder</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">		<span class="type">byte</span> rnd[] = <span class="keyword">new</span> <span class="title class_">byte</span>[BCRYPT_SALT_LEN];</span><br><span class="line"> </span><br><span class="line">		random.nextBytes(rnd);</span><br><span class="line"> </span><br><span class="line">		rs.append(<span class="string">&quot;$2a$&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (log_rounds &lt; <span class="number">10</span>) &#123;</span><br><span class="line">			rs.append(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		rs.append(log_rounds);</span><br><span class="line">		rs.append(<span class="string">&quot;$&quot;</span>);</span><br><span class="line">		encode_base64(rnd, rnd.length, rs);</span><br><span class="line">		<span class="keyword">return</span> rs.toString();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">hashpw</span><span class="params">(String password, String salt)</span> &#123;</span><br><span class="line">		String real_salt;</span><br><span class="line">		<span class="type">byte</span> passwordb[], saltb[], hashed[];</span><br><span class="line">		<span class="type">char</span> <span class="variable">minor</span> <span class="operator">=</span> (<span class="type">char</span>) <span class="number">0</span>;</span><br><span class="line">		<span class="type">int</span> rounds, off = <span class="number">0</span>;</span><br><span class="line">		<span class="type">StringBuilder</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"> </span><br><span class="line">		<span class="type">int</span> <span class="variable">saltLength</span> <span class="operator">=</span> salt.length();</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">if</span> (saltLength &lt; <span class="number">28</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Invalid salt&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">if</span> (salt.charAt(<span class="number">0</span>) != <span class="string">&#x27;$&#x27;</span> || salt.charAt(<span class="number">1</span>) != <span class="string">&#x27;2&#x27;</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Invalid salt version&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (salt.charAt(<span class="number">2</span>) == <span class="string">&#x27;$&#x27;</span>) &#123;</span><br><span class="line">			off = <span class="number">3</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			minor = salt.charAt(<span class="number">2</span>);</span><br><span class="line">			<span class="keyword">if</span> (minor != <span class="string">&#x27;a&#x27;</span> || salt.charAt(<span class="number">3</span>) != <span class="string">&#x27;$&#x27;</span>) &#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Invalid salt revision&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			off = <span class="number">4</span>;</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">if</span> (saltLength - off &lt; <span class="number">25</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Invalid salt&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="comment">// Extract number of rounds</span></span><br><span class="line">		<span class="keyword">if</span> (salt.charAt(off + <span class="number">2</span>) &gt; <span class="string">&#x27;$&#x27;</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Missing salt rounds&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		rounds = Integer.parseInt(salt.substring(off, off + <span class="number">2</span>));</span><br><span class="line"> </span><br><span class="line">		real_salt = salt.substring(off + <span class="number">3</span>, off + <span class="number">25</span>);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			passwordb = (password + (minor &gt;= <span class="string">&#x27;a&#x27;</span> ? <span class="string">&quot;\000&quot;</span> : <span class="string">&quot;&quot;</span>)).getBytes(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (UnsupportedEncodingException uee) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AssertionError</span>(<span class="string">&quot;UTF-8 is not supported&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		saltb = decode_base64(real_salt, BCRYPT_SALT_LEN);</span><br><span class="line"> </span><br><span class="line">		hashed = crypt_raw(passwordb, saltb, rounds);</span><br><span class="line"> </span><br><span class="line">		rs.append(<span class="string">&quot;$2&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (minor &gt;= <span class="string">&#x27;a&#x27;</span>) &#123;</span><br><span class="line">			rs.append(minor);</span><br><span class="line">		&#125;</span><br><span class="line">		rs.append(<span class="string">&quot;$&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (rounds &lt; <span class="number">10</span>) &#123;</span><br><span class="line">			rs.append(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		rs.append(rounds);</span><br><span class="line">		rs.append(<span class="string">&quot;$&quot;</span>);</span><br><span class="line">		encode_base64(saltb, saltb.length, rs);</span><br><span class="line">		encode_base64(hashed, bf_crypt_ciphertext.length * <span class="number">4</span> - <span class="number">1</span>, rs);</span><br><span class="line">		<span class="keyword">return</span> rs.toString();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="type">byte</span>[] crypt_raw(<span class="type">byte</span> password[], <span class="type">byte</span> salt[], <span class="type">int</span> log_rounds) &#123;</span><br><span class="line">		<span class="type">int</span> cdata[] = (<span class="type">int</span>[]) bf_crypt_ciphertext.clone();</span><br><span class="line">		<span class="type">int</span> <span class="variable">clen</span> <span class="operator">=</span> cdata.length;</span><br><span class="line">		<span class="type">byte</span> ret[];</span><br><span class="line"> </span><br><span class="line">		<span class="type">long</span> <span class="variable">rounds</span> <span class="operator">=</span> roundsForLogRounds(log_rounds);</span><br><span class="line"> </span><br><span class="line">		init_key();</span><br><span class="line">		ekskey(salt, password);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; rounds; i++) &#123;</span><br><span class="line">			key(password);</span><br><span class="line">			key(salt);</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; (clen &gt;&gt; <span class="number">1</span>); j++) &#123;</span><br><span class="line">				encipher(cdata, j &lt;&lt; <span class="number">1</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		ret = <span class="keyword">new</span> <span class="title class_">byte</span>[clen * <span class="number">4</span>];</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = <span class="number">0</span>; i &lt; clen; i++) &#123;</span><br><span class="line">			ret[j++] = (<span class="type">byte</span>) ((cdata[i] &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">			ret[j++] = (<span class="type">byte</span>) ((cdata[i] &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">			ret[j++] = (<span class="type">byte</span>) ((cdata[i] &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">			ret[j++] = (<span class="type">byte</span>) (cdata[i] &amp; <span class="number">0xff</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">static</span> <span class="type">long</span> <span class="title function_">roundsForLogRounds</span><span class="params">(<span class="type">int</span> log_rounds)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (log_rounds &lt; <span class="number">4</span> || log_rounds &gt; <span class="number">31</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Bad number of rounds&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1L</span> &lt;&lt; log_rounds;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">ekskey</span><span class="params">(<span class="type">byte</span> data[], <span class="type">byte</span> key[])</span> &#123;</span><br><span class="line">		<span class="type">int</span> i;</span><br><span class="line">		<span class="type">int</span> koffp[] = &#123; <span class="number">0</span> &#125;, doffp[] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">		<span class="type">int</span> lr[] = &#123; <span class="number">0</span>, <span class="number">0</span> &#125;;</span><br><span class="line">		<span class="type">int</span> <span class="variable">plen</span> <span class="operator">=</span> P.length, slen = S.length;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; plen; i++) &#123;</span><br><span class="line">			P[i] = P[i] ^ streamtoword(key, koffp);</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; plen; i += <span class="number">2</span>) &#123;</span><br><span class="line">			lr[<span class="number">0</span>] ^= streamtoword(data, doffp);</span><br><span class="line">			lr[<span class="number">1</span>] ^= streamtoword(data, doffp);</span><br><span class="line">			encipher(lr, <span class="number">0</span>);</span><br><span class="line">			P[i] = lr[<span class="number">0</span>];</span><br><span class="line">			P[i + <span class="number">1</span>] = lr[<span class="number">1</span>];</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; slen; i += <span class="number">2</span>) &#123;</span><br><span class="line">			lr[<span class="number">0</span>] ^= streamtoword(data, doffp);</span><br><span class="line">			lr[<span class="number">1</span>] ^= streamtoword(data, doffp);</span><br><span class="line">			encipher(lr, <span class="number">0</span>);</span><br><span class="line">			S[i] = lr[<span class="number">0</span>];</span><br><span class="line">			S[i + <span class="number">1</span>] = lr[<span class="number">1</span>];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">streamtoword</span><span class="params">(<span class="type">byte</span> data[], <span class="type">int</span> offp[])</span> &#123;</span><br><span class="line">		<span class="type">int</span> i;</span><br><span class="line">		<span class="type">int</span> <span class="variable">word</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">		<span class="type">int</span> <span class="variable">off</span> <span class="operator">=</span> offp[<span class="number">0</span>];</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">			word = (word &lt;&lt; <span class="number">8</span>) | (data[off] &amp; <span class="number">0xff</span>);</span><br><span class="line">			off = (off + <span class="number">1</span>) % data.length;</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		offp[<span class="number">0</span>] = off;</span><br><span class="line">		<span class="keyword">return</span> word;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">encipher</span><span class="params">(<span class="type">int</span> lr[], <span class="type">int</span> off)</span> &#123;</span><br><span class="line">		<span class="type">int</span> i, n, l = lr[off], r = lr[off + <span class="number">1</span>];</span><br><span class="line"> </span><br><span class="line">		l ^= P[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= BLOWFISH_NUM_ROUNDS - <span class="number">2</span>;) &#123;</span><br><span class="line">			<span class="comment">// Feistel substitution on left word</span></span><br><span class="line">			n = S[(l &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>];</span><br><span class="line">			n += S[<span class="number">0x100</span> | ((l &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>)];</span><br><span class="line">			n ^= S[<span class="number">0x200</span> | ((l &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>)];</span><br><span class="line">			n += S[<span class="number">0x300</span> | (l &amp; <span class="number">0xff</span>)];</span><br><span class="line">			r ^= n ^ P[++i];</span><br><span class="line"> </span><br><span class="line">			<span class="comment">// Feistel substitution on right word</span></span><br><span class="line">			n = S[(r &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>];</span><br><span class="line">			n += S[<span class="number">0x100</span> | ((r &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>)];</span><br><span class="line">			n ^= S[<span class="number">0x200</span> | ((r &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>)];</span><br><span class="line">			n += S[<span class="number">0x300</span> | (r &amp; <span class="number">0xff</span>)];</span><br><span class="line">			l ^= n ^ P[++i];</span><br><span class="line">		&#125;</span><br><span class="line">		lr[off] = r ^ P[BLOWFISH_NUM_ROUNDS + <span class="number">1</span>];</span><br><span class="line">		lr[off + <span class="number">1</span>] = l;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">key</span><span class="params">(<span class="type">byte</span> key[])</span> &#123;</span><br><span class="line">		<span class="type">int</span> i;</span><br><span class="line">		<span class="type">int</span> koffp[] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">		<span class="type">int</span> lr[] = &#123; <span class="number">0</span>, <span class="number">0</span> &#125;;</span><br><span class="line">		<span class="type">int</span> <span class="variable">plen</span> <span class="operator">=</span> P.length, slen = S.length;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; plen; i++) &#123;</span><br><span class="line">			P[i] = P[i] ^ streamtoword(key, koffp);</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; plen; i += <span class="number">2</span>) &#123;</span><br><span class="line">			encipher(lr, <span class="number">0</span>);</span><br><span class="line">			P[i] = lr[<span class="number">0</span>];</span><br><span class="line">			P[i + <span class="number">1</span>] = lr[<span class="number">1</span>];</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; slen; i += <span class="number">2</span>) &#123;</span><br><span class="line">			encipher(lr, <span class="number">0</span>);</span><br><span class="line">			S[i] = lr[<span class="number">0</span>];</span><br><span class="line">			S[i + <span class="number">1</span>] = lr[<span class="number">1</span>];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(CharSequence rawPassword, String encodedPassword)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (encodedPassword == <span class="literal">null</span> || encodedPassword.length() == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">if</span> (!BCRYPT_PATTERN.matcher(encodedPassword).matches()) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">return</span> checkpw(rawPassword.toString(), encodedPassword);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">checkpw</span><span class="params">(String plaintext, String hashed)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> equalsNoEarlyReturn(hashed, hashpw(plaintext, hashed));</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">equalsNoEarlyReturn</span><span class="params">(String a, String b)</span> &#123;</span><br><span class="line">		<span class="type">char</span>[] caa = a.toCharArray();</span><br><span class="line">		<span class="type">char</span>[] cab = b.toCharArray();</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">if</span> (caa.length != cab.length) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="type">byte</span> <span class="variable">ret</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; caa.length; i++) &#123;</span><br><span class="line">			ret |= caa[i] ^ cab[i];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">return</span> <span class="variable">ret</span> <span class="operator">=</span>= <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a>五、总结</h1><ol>
<li>Bcrypt生成的密文是60位的。而MD5的是32位的。</li>
<li>Bcrypt的破解成本更高。</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noarsark.github.io/2020/06/02/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E4%B8%80%EF%BC%89%E2%80%94%E2%80%94%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%A6%82%E8%BF%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="noarsark">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="noarsark's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | noarsark's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/06/02/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E4%B8%80%EF%BC%89%E2%80%94%E2%80%94%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%A6%82%E8%BF%B0/" class="post-title-link" itemprop="url">设计模式（一）——设计模式概述</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-02 21:49:06" itemprop="dateCreated datePublished" datetime="2020-06-02T21:49:06+08:00">2020-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-12-01 15:31:28" itemprop="dateModified" datetime="2020-12-01T15:31:28+08:00">2020-12-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="设计模式（一）——设计模式概述"><a href="#设计模式（一）——设计模式概述" class="headerlink" title="设计模式（一）——设计模式概述"></a>设计模式（一）——设计模式概述</h1><p>在软件工程中，设计模式（design pattern）是对软件设计中普遍存在的各种问题，所提出的解决方案。设计模式并不是固定的一套代码，而是针对某一特定问题的具体解决思路与方案。可以认为是一种最佳实践，因为他是无数软件开发人员经过长时间的实践总结出来的。</p>
<p>提到设计模式不得不提《<a target="_blank" rel="noopener" href="http://s.click.taobao.com/t?e=m=2&s=Rrn8i/toKpkcQipKwQzePOeEDrYVVa64K7Vc7tFgwiHjf2vlNIV67nJWhH+bVvPVNIp4fcwrAVlpS4hLH/P02ckKYNRBWOBBey11vvWwHXSniyi5vWXIZhtlrJbLMDAQihpQCXu2JnMU7C4KV/o0CcYMXU3NNCg/&pvid=10_42.120.74.171_172_1459430328764">设计模式：可复用面向对象软件的基础</a>》（Design Patterns – Elements of Reusable Object-Oriented Software） 一书。这本书由著名的四人帮——GoF(Gang of Four)编写，其中总结了23种设计模式，并将他们分成几个大类。</p>
<h2 id="设计模式的六大原则"><a href="#设计模式的六大原则" class="headerlink" title="设计模式的六大原则"></a>设计模式的六大原则</h2><h3 id="1、开闭原则（Open-Close-Principle）"><a href="#1、开闭原则（Open-Close-Principle）" class="headerlink" title="1、开闭原则（Open Close Principle）"></a>1、开闭原则（Open Close Principle）</h3><p>开闭原则就是说对扩展开放，对修改关闭。在程序需要进行拓展的时候，不能去修改原有的代码，实现一个热插拔的效果。所以一句话概括就是：为了使程序的扩展性好，易于维护和升级。想要达到这样的效果，我们需要使用接口和抽象类，后面的具体设计中我们会提到这点。</p>
<h3 id="2、里氏代换原则（Liskov-Substitution-Principle）"><a href="#2、里氏代换原则（Liskov-Substitution-Principle）" class="headerlink" title="2、里氏代换原则（Liskov Substitution Principle）"></a>2、里氏代换原则（Liskov Substitution Principle）</h3><p>里氏代换原则(Liskov Substitution Principle LSP)面向对象设计的基本原则之一。 里氏代换原则中说，任何基类可以出现的地方，子类一定可以出现。 LSP是继承复用的基石，只有当衍生类可以替换掉基类，软件单位的功能不受到影响时，基类才能真正被复用，而衍生类也能够在基类的基础上增加新的行为。里氏代换原则是对“开-闭”原则的补充。实现“开-闭”原则的关键步骤就是抽象化。而基类与子类的继承关系就是抽象化的具体实现，所以里氏代换原则是对实现抽象化的具体步骤的规范。</p>
<h3 id="3、依赖倒转原则（Dependence-Inversion-Principle）"><a href="#3、依赖倒转原则（Dependence-Inversion-Principle）" class="headerlink" title="3、依赖倒转原则（Dependence Inversion Principle）"></a>3、依赖倒转原则（Dependence Inversion Principle）</h3><p>这个是开闭原则的基础，具体内容：真对接口编程，依赖于抽象而不依赖于具体。</p>
<h3 id="4、接口隔离原则（Interface-Segregation-Principle）"><a href="#4、接口隔离原则（Interface-Segregation-Principle）" class="headerlink" title="4、接口隔离原则（Interface Segregation Principle）"></a>4、接口隔离原则（Interface Segregation Principle）</h3><p>这个原则的意思是：使用多个隔离的接口，比使用单个接口要好。还是一个降低类之间的耦合度的意思，从这儿我们看出，其实设计模式就是一个软件的设计思想，从大型软件架构出发，为了升级和维护方便。所以上文中多次出现：降低依赖，降低耦合。</p>
<h3 id="5、迪米特法则（最少知道原则）（Demeter-Principle）"><a href="#5、迪米特法则（最少知道原则）（Demeter-Principle）" class="headerlink" title="5、迪米特法则（最少知道原则）（Demeter Principle）"></a>5、迪米特法则（最少知道原则）（Demeter Principle）</h3><p>为什么叫最少知道原则，就是说：一个实体应当尽量少的与其他实体之间发生相互作用，使得系统功能模块相对独立。</p>
<h3 id="6、合成复用原则（Composite-Reuse-Principle）"><a href="#6、合成复用原则（Composite-Reuse-Principle）" class="headerlink" title="6、合成复用原则（Composite Reuse Principle）"></a>6、合成复用原则（Composite Reuse Principle）</h3><p>合成复用原则是尽量使用合成&#x2F;聚合的方式，而不是使用继承。</p>
<p>其中前四种也是<a target="_blank" rel="noopener" href="http://47.103.216.138/archives/220">面向对象的四个基本原则</a>。</p>
<h2 id="设计模式分类"><a href="#设计模式分类" class="headerlink" title="设计模式分类"></a>设计模式分类</h2><p>设计模式分为三种类型，共23种。</p>
<p>创建型模式：单例模式、抽象工厂模式、建造者模式、工厂模式、原型模式。</p>
<p>结构型模式：适配器模式、桥接模式、装饰模式、组合模式、外观模式、享元模式、代理模式。</p>
<p>行为型模式：模版方法模式、命令模式、迭代器模式、观察者模式、中介者模式、备忘录模式、解释器模式（Interpreter模式）、状态模式、策略模式、职责链模式(责任链模式)、访问者模式。</p>
<h2 id="23种设计模式简单介绍"><a href="#23种设计模式简单介绍" class="headerlink" title="23种设计模式简单介绍"></a>23种设计模式简单介绍</h2><p>按字典序排列简介如下。</p>
<p>Abstract Factory（抽象工厂模式）：提供一个创建一系列相关或相互依赖对象的接口，而无需指定它们具体的类。</p>
<p>Adapter（适配器模式）：将一个类的接口转换成客户希望的另外一个接口。Adapter模式使得原本由于接口不兼容而不能一起工作的那些类可以一起工作。</p>
<p>Bridge（桥接模式）：将抽象部分与它的实现部分分离，使它们都可以独立地变化。</p>
<p>Builder（建造者模式）：将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。</p>
<p>Chain of Responsibility（责任链模式）：为解除请求的发送者和接收者之间耦合，而使多个对象都有机会处理这个请求。将这些对象连成一条链，并沿着这条链传递该请求，直到有一个对象处理它。</p>
<p>Command（命令模式）：将一个请求封装为一个对象，从而使你可用不同的请求对客户进行参数化；对请求排队或记录请求日志，以及支持可取消的操作。</p>
<p>Composite（组合模式）：将对象组合成树形结构以表示“部分-整体”的层次结构。它使得客户对单个对象和复合对象的使用具有一致性。</p>
<p>Decorator（装饰模式）：动态地给一个对象添加一些额外的职责。就扩展功能而言， 它比生成子类方式更为灵活。</p>
<p>Facade（外观模式）：为子系统中的一组接口提供一个一致的界面，Facade模式定义了一个高层接口，这个接口使得这一子系统更加容易使用。</p>
<p>Factory Method（工厂模式）：定义一个用于创建对象的接口，让子类决定将哪一个类实例化。Factory Method使一个类的实例化延迟到其子类。</p>
<p>Flyweight（享元模式）：运用共享技术有效地支持大量细粒度的对象。</p>
<p>Interpreter（解析器模式）：给定一个语言, 定义它的文法的一种表示，并定义一个解释器, 该解释器使用该表示来解释语言中的句子。</p>
<p>Iterator（迭代器模式）：提供一种方法顺序访问一个聚合对象中各个元素，而又不需暴露该对象的内部表示。</p>
<p>Mediator（中介模式）：用一个中介对象来封装一系列的对象交互。中介者使各对象不需要显式地相互引用，从而使其耦合松散，而且可以独立地改变它们之间的交互。</p>
<p>Memento（备忘录模式）：在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态。这样以后就可将该对象恢复到保存的状态。</p>
<p>Observer（观察者模式）：定义对象间的一种一对多的依赖关系,以便当一个对象的状态发生改变时,所有依赖于它的对象都得到通知并自动刷新。</p>
<p>Prototype（原型模式）：用原型实例指定创建对象的种类，并且通过拷贝这个原型来创建新的对象。</p>
<p>Proxy（代理模式）：为其他对象提供一个代理以控制对这个对象的访问。</p>
<p>Singleton（单例模式）：保证一个类仅有一个实例，并提供一个访问它的全局访问点。 单例模式是最简单的设计模式之一，但是对于Java的开发者来说，它却有很多缺陷。在九月的专栏中，David Geary探讨了单例模式以及在面对多线程（multi-threading）、类装载器（class loaders）和序列化（serialization）时如何处理这些缺陷。 State（状态模式）：允许一个对象在其内部状态改变时改变它的行为。对象看起来似乎修改了它所属的类。</p>
<p>Strategy（策略模式）：定义一系列的算法,把它们一个个封装起来, 并且使它们可相互替换。本模式使得算法的变化可独立于使用它的客户。</p>
<p>Template Method（模板方法模式）：定义一个操作中的算法的骨架，而将一些步骤延迟到子类中。Template Method使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤。</p>
<p>Visitor（访问者模式）：表示一个作用于某对象结构中的各元素的操作。它使你可以在不改变各元素的类的前提下定义作用于这些元素的新操作。</p>
<h2 id="23种设计模式之间的关系"><a href="#23种设计模式之间的关系" class="headerlink" title="23种设计模式之间的关系"></a>23种设计模式之间的关系</h2><p>图片来自网络，侵删</p>
<p><img src="D:\CS\blog\source\gallery\design_pattern_relation.jpg" alt="设计模式之间关系"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noarsark.github.io/2020/04/16/%E8%AF%BB%E9%98%BF%E9%87%8C%E3%80%8AJava%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E3%80%8B%E7%AC%94%E8%AE%B0(%E4%B8%80)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="noarsark">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="noarsark's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | noarsark's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/16/%E8%AF%BB%E9%98%BF%E9%87%8C%E3%80%8AJava%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E3%80%8B%E7%AC%94%E8%AE%B0(%E4%B8%80)/" class="post-title-link" itemprop="url">读阿里《Java开发手册》笔记(一)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-16 15:32:40" itemprop="dateCreated datePublished" datetime="2020-04-16T15:32:40+08:00">2020-04-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-12-22 22:34:31" itemprop="dateModified" datetime="2020-12-22T22:34:31+08:00">2020-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="左移-lt-lt-和右移-gt-gt"><a href="#左移-lt-lt-和右移-gt-gt" class="headerlink" title="左移&lt;&lt;和右移&gt;&gt;"></a>左移&lt;&lt;和右移&gt;&gt;</h1><p>在左移&lt;&lt;和右移&gt;&gt;两种运算中，符号位均参与移动，除负数往右移动，高位补1之外，其他情况均在空位补0。</p>
<h1 id="无符号右移-gt-gt-gt"><a href="#无符号右移-gt-gt-gt" class="headerlink" title="无符号右移&gt;&gt;&gt;"></a>无符号右移&gt;&gt;&gt;</h1><p>当向右移动时，正负数高位均补0，正数不断向右移动的最小值是0，而负数不断向右移动的最小值是1。无符号意即藐视符号位，符号位失去特权，必须像其他平常的数字位一起向右移动，高位直接补0，根本不关心是正数还是负数。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/04/16/%E8%AF%BB%E9%98%BF%E9%87%8C%E3%80%8AJava%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E3%80%8B%E7%AC%94%E8%AE%B0(%E4%B8%80)/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noarsark.github.io/2019/09/15/Java%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="noarsark">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="noarsark's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | noarsark's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/09/15/Java%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">Java基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-09-15 12:28:09" itemprop="dateCreated datePublished" datetime="2019-09-15T12:28:09+08:00">2019-09-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-09-27 20:11:00" itemprop="dateModified" datetime="2020-09-27T20:11:00+08:00">2020-09-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>重新回顾Java基础知识</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/09/15/Java%E5%9F%BA%E7%A1%80/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">noarsark</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
